window.xin=function(){"use strict";var a={set:function(a,b){var c,d,e=this;if("xin."!==a.substr(0,4))throw new Error('Namespace not accepted, should be prefixed with "xin."');c=a.substr(4).split("."),d=c[c.length-1];for(var f in c){var g=c[f];e[g]=g===d?b:e[g]||{},e=e[g]}}};return window.jQuery?(a.when=jQuery.when,a.Deferred=jQuery.Deferred,a.$=jQuery):window.Zepto&&(Deferred.installInto(a),Zepto.Deferred||Deferred.installInto(Zepto),a.$=Zepto),window.Zepto&&(a.$.fn.detach=a.$.fn.remove),a.$.fn.serializeObject=function(){var b={};return _.each(a.$(this).serializeArray(),function(a){b[a.name]=a.value}),b},a}(),function(a){"use strict";var b=document.body,c=navigator.userAgent,d=~c.indexOf("iPhone")||~c.indexOf("iPod"),e=~c.indexOf("iPad"),f=d||e,g=window.navigator.standalone,h=~c.indexOf("Android"),i="mozRequestAnimationFrame"in window,j="webkitRequestAnimationFrame"in window,k=0;a.set("xin.detect",{ua:c,iphone:d,ipad:e,ios:f,fullscreen:g,android:h,moz:i,webkit:j});var l=a.$.fn.css;a.$.fn.css=function(b,c){if("string"==typeof b)switch(b){case"transform":case"transition":a.detect.moz&&l.call(this,"-moz-"+b,c),a.detect.webkit&&l.call(this,"-webkit-"+b,c)}return l.apply(this,arguments)},h&&(window.onscroll=function(){b.style.height=window.innerHeight+"px"});var m=window.onload=function(){if(f){var a=document.documentElement.clientHeight;d&&!g&&(a+=60),b.style.height=a+"px"}else h&&(b.style.height=window.innerHeight+56+"px");setTimeout(scrollTo,0,0,1)};window.onresize=function(){var a=b.offsetWidth;k!=a&&(k=a,m())},window.onresize()}(window.xin),function(a){"use strict";var b=function(){this.initialize.apply(this,arguments)};_.extend(b.prototype,Backbone.Events,{initialize:function(b){var c=this;this.options=b=b||{},this.container=new a.IoC,this.router=b.router||new a.Router,this.router.app=this,this.directiveManager=new a.DirectiveManager(this),b.directives&&a.$.each(b.directives,function(a,b){c.directiveManager.put(a,b)}),this.$el=a.$(b.el),this.$el.addClass("xin-app").attr("data-role","app"),this.providerRepository=new a.ProviderRepository(this),a.app=a.app||this},remove:function(){this.$el.removeClass("xin-app").removeAttr("data-role")},start:function(){var b=this;this.baseURL=location.href.split("#")[0],this.catchAllHref(),a.when(this.providerRepository.initialize()).then(function(){return b.directiveManager.scan()}).done(function(){a.$("body").show(),"function"==typeof b.router.start?b.router.start():Backbone.history.start()})},catchAllHref:function(){var b=this;this.$el.on("click","a",function(c){var d=a.$(this).attr("href");"#"!==d[0]&&("/"===d[0]&&(d=location.origin+d),c.preventDefault(),d=b.simplifyURL(d),location.hash=d.split("#")[0]==location.href.split("#")[0]?"#_":"#"+d)}),this.$el.on("submit","form",function(b){b.preventDefault(),a.$.ajax({url:a.$(this).attr("action"),method:a.$(this).attr("method"),data:a.$(this).serialize()}).done(function(a,b){alert(b)}).fail(function(a,b,c){alert(c)})})},simplifyURL:function(a){return 0==a.indexOf(this.baseURL)&&(a=a.substr(this.baseURL.length)),a},set:function(){this.container.set.apply(this.container,arguments)},get:function(){return this.container.get.apply(this.container,arguments)},resolve:function(){return this.container.resolve.apply(this.container,arguments)},use:function(a){this.router.use(a)}}),a.set("xin.App",b)}(window.xin),function(a){"use strict";var b=function(){this.initialize.apply(this,arguments)};_.extend(b.prototype,{context:{},fallbackContext:null,initialize:function(a){a=a||{},this.fallbackContext=a.fallbackContext||window,this.aliases={app:"xin.App",view:"xin.ui.Outlet",layout:"xin.ui.Layout",header:"xin.ui.Header",pane:"xin.ui.Pane",list:"xin.ui.List"}},clear:function(){this.context={},this.context.prototype=this.fallbackContext},get:function(a){var b,c=a.split("."),d=this.context;return d=this.context,(b=_.every(c,function(a){return d=d[a]||void 0,void 0!==d}))?d:(d=this.fallbackContext,b=_.every(c,function(a){return d=d[a]||void 0,void 0!==d}),b?d:void 0)},set:function(a,b){var c=a.split("."),d=this.context,e=0;_.each(c,function(a){e++,e==c.length?d[a]=b:(d[a]||(d[a]={}),d=d[a])})},createObject:function(b){var c,d=a.Deferred(),e=[];for(var f in arguments)e.push(arguments[f]);switch(e=e.slice(1),e.length){case 0:c=new b;break;case 1:c=new b(e[0]);break;case 2:c=new b(e[0],e[1]);break;case 3:c=new b(e[0],e[1],e[2]);break;case 4:c=new b(e[0],e[1],e[2],e[3]);break;case 5:c=new b(e[0],e[1],e[2],e[3],e[4])}return d.resolve(c),d.promise()},resolveAlias:function(a){var b;do b=!1,this.aliases[a]&&(a=this.aliases[a],b=!0);while(b);return a},resolve:function(c){var d,e,f,g="",h=a.Deferred(),i=[];if(c=this.resolveAlias(c),!c)return h.reject(new Error("Key not found or cannot resolve!")).promise();for(var j in arguments)i.push(arguments[j]);if("function"==typeof c)this.createObject.apply(this,i).then(h.resolve,h.reject);else if("string"==typeof c)if(d=c.indexOf(":"),d>=0&&(g=c.substr(0,d),c=c.substr(d+1)),g)try{e=b.getResolver(g),i[0]=c,e.apply(this,i).then(h.resolve,h.reject)}catch(k){h.resolve(c)}else if(f=this.get(c),"function"==typeof f){var l=_.last(c.split("."))[0];l.toUpperCase()==l?(i[0]=f,this.createObject.apply(this,i).then(h.resolve,h.reject)):h.resolve(f.apply(void 0,i.slice(1)))}else h.resolve(f);else h.resolve(c);return h.promise()}}),_.extend(b,{resolvers:{xhr:function(b){return a.$.get(b).then(null,function(b,c,d){return a.Deferred().reject(new Error(d)).promise()}).promise()},template:function(c){var d=a.$("script#"+c);if(d.length>0)return a.Deferred().resolve(_.template(d.html())).promise();var e=b.getResolver("xhr");return e(c).then(function(b){return a.Deferred().resolve(_.template(b))},null)},model:function(a){return this.resolve(a)},collection:function(b){var c=a.Deferred();return a.when(this.resolve(b)).then(function(a){a instanceof Backbone.Collection||(a=new Backbone.Collection(a)),c.resolve(a)}),c.promise()}},addResolver:function(a,b){this.resolvers[a]=b},getResolver:function(a){var b=this.resolvers[a];if("function"==typeof b)return b;if("object"==typeof b&&"function"==typeof b.resolve)return b.resolve;throw new Error("IoC Resolver ["+a+"] not found!")}}),a.set("xin.IoC",b)}(window.xin),function(a){"use strict";var b=function(){this.middlewares=[],Backbone.Router.apply(this,arguments)};_.extend(b.prototype,Backbone.Router.prototype,{start:function(){this.setDefaultRoute(),Backbone.history.start()},setDefaultRoute:function(){Backbone.history.handlers.push({route:/^(.*?)$/,callback:_.bind(this.options&&this.options.routeMissing||this.routeMissing,this)})},registerView:function(a,b){this.viewRoutes[a]=b,(!this.viewDefaultRoute||b.data("uri-default"))&&(this.viewDefaultRoute=a)},routeMissing:function(b){b=b.trim();var c=this,d=this.app.simplifyURL(b);if(b!==d)return location.hash=d,void 0;var e=c.viewRoutes[b],f=function(){e=a.$(".xin-pane > .xin-view"),c.viewDefaultRoute="_",e.attr("data-uri","_"),c.registerView("_",e)};e||"_"!=b||f(),""===b?(c.viewDefaultRoute||f(),location.hash=c.viewDefaultRoute):e?a.ui.show(e.data("instance")):a.$.get(b).done(function(d){d=d.trim(),d.indexOf("<body")>=0?(d=d.substr(d.indexOf("<body")+1),d="<div>"+d.substr(d.indexOf(">")+1)+"</div>"):d.indexOf("<BODY")>=0?(d=d.substr(d.indexOf("<BODY")+1),d="<div>"+d.substr(d.indexOf(">")+1)+"</div>"):d="<div>"+d+"</div>";var e=a.$(d);if(e.find("[data-role]").length>0){var f=e.find("[data-role]");f=f.filter(function(){var b=c.app.get(c.app.container.resolveAlias(a.$(this).data("role")));return b.prototype instanceof Backbone.View&&!(b.prototype instanceof a.ui.Container)}),f.length>0&&(e=f,e.attr("data-uri",b))}else e.find("body").length>0&&(e=e.find("body")),d=e.html()||"",e=a.$('<div data-role="view" data-uri="'+b+'">'+d+"</div>");c.mainViewport.append(e),a.when(c.app.directiveManager.scan()).done(function(){c.routeMissing(b)})}).fail(function(){console.error('Missing route for URI: "'+b+'"')})},show:function(a){a&&("function"==typeof a.show?a.show():a.$el.addClass("hz-show"))},route:function(a){var b,c=[],d=this;if(arguments.length>1)for(var e=1;e<arguments.length;e++)c.push(b=arguments[e]);Backbone.Router.prototype.route.call(this,a,function(){var a=arguments;d.runMiddleware.call(d,b.options||{}).done(function(){b.apply(d,a)})})},use:function(a){a.app=this.app,this.middlewares.push(a)},runMiddleware:function(b){var c=(this.app,null);return _.each(this.middlewares,function(a){c=c?c.then(function(){return a.call(b)}):a.call(b)}),c||(c=a.Deferred().resolve().promise()),c}}),a.set("xin.Router",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a,this.directives={}};_.extend(b.prototype,{put:function(a,b){if(!b)throw new Error('Directive for "'+a+'" not found or invalid!');if("function"==typeof b){var c=b;b=new c(this.app)}this.directives[a]=b},scan:function(b){var c,d=this,e=[],f=new a.Deferred,g=function(){e=[],b.children().each(function(){var b=a.$(this);e.push(d.scan(b))}),a.$.when.apply(null,e).done(function(){f.resolve()})},h=function(c){return function(d){return d?(g(),a.Deferred().reject().promise()):c.run(b)}};return b=b||this.app.$el,_.each(this.directives,function(a){a.matcher(b)&&(c=c?c.then(h(a)):a.run(b))}),c||(c=a.Deferred().resolve().promise()),c.done(g),f.promise()}}),a.set("xin.DirectiveManager",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a,this.providers=[]};_.extend(b.prototype,{add:function(a){if(!a)throw new Error("Provider not found or invalid!");if("function"==typeof a){var b=a;a=new b}this.providers.push(a)},initialize:function(){var b=this.app,c=null;return _.each(this.providers,function(a){c=c?c.then(function(){return a.initialize(b)}):a.initialize(b)}),c||(c=a.Deferred().resolve().promise()),c}}),a.set("xin.ProviderRepository",b)}(window.xin),function(a){var b=function(a,b){this.$el=a,this.to=b,this.timeout=.3};_.extend(b.prototype,{play:function(){var b=this,c=a.Deferred();this.$el.on("transitionend",function(){b.$el.off("transitionend"),b.$el.css("transition",""),b.$el.css("transform",""),c.resolve()});var d="100%";return"right"==this.to&&(d="-"+d),this.$el.css("transform","translate3d("+d+", 0, 0)"),this.$el.css("transition","all "+b.timeout+"s"),b.$el.addClass("xin-show"),setTimeout(function(){b.$el.css("transform","translate3d(0, 0, 0)")},a.fx.defaultOptions.delay),c.promise()}});var c=function(a,b){this.$el=a,this.to=b,this.timeout=.3};_.extend(c.prototype,{play:function(){var b=this,c=a.Deferred();return this.$el.on("transitionend",function(){b.$el.off("transitionend"),b.$el.removeClass("xin-show"),b.$el.css("transition",""),b.$el.css("transform",""),c.resolve()}),this.$el.css("transform","translate3d(0, 0, 0)"),this.$el.css("transition","all "+b.timeout+"s"),setTimeout(function(){var a="100%";"left"==b.to&&(a="-"+a),b.$el.css("transform","translate3d("+a+", 0, 0)")},a.fx.defaultOptions.delay),c.promise()}}),a.set("xin.fx",{defaultOptions:{delay:300},SlideIn:b,SlideOut:c})}(window.xin),function(a){"use strict";a.set("xin.ui",{show:function(a){_.defer(function(){a.parent&&a.parent.showChild?a.parent.showChild(a).done(function(){a.$el[0].scrollTop=0,a.$el.addClass("xin-show")}):a.$el.addClass("xin-show")})}})}(window.xin),function(a){"use strict";var b=function(a){this.app=a};_.extend(b.prototype,{matcher:function(a){return a.data("role")&&"app"===a.data("role").toLowerCase()},run:function(b){var c=a.Deferred();return b.attr("instantiated",!0).addClass("xin-role").data("instance",this.app),c.resolve(),c.promise()}}),a.set("xin.directive.AppDirective",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a};_.extend(b.prototype,{matcher:function(a){return a.data("role")&&"app"!==a.data("role").toLowerCase()?!0:void 0},run:function(b){var c,d,e=[],f=new a.Deferred,g=this.app;return b.data("instantiated")?f.resolve().promise():(c=_.defaults(b.data(),{el:b,app:g}),d=c.role,delete c.role,_.each(c,function(a,b){if("string"==typeof a){a=b+":"+a;var d=g.resolve(a).then(function(a){c[b]=a});e.push(d)}}),a.when.apply(null,e).done(function(){g.resolve(d,c).done(function(b){var c,e;if(!b)throw new Error('Role: "'+d+'" undefined');if((c=b.$el)&&(e=c.parent(".xin-role"),c.attr("data-instantiated",!0).data("instance",b).attr("data-cid",b.cid),e.length)){var g=e.data("instance");g.addChild&&g.addChild(b)}b instanceof Backbone.View&&(b.app=b.options.app,b.$el.addClass("xin-role"),b instanceof a.ui.Pane||b.$el.addClass("xin-view"),b.render()),f.resolve()}).fail(function(){console.log(arguments)})}),f.promise())}}),a.set("xin.directive.RoleDirective",b)}(window.xin),function(a){var b=function(a){this.app=a,this.router=a.router,this.router.viewRoutes=a.router.viewRoutes||{},this.router.viewDefaultRoute=null};_.extend(b.prototype,{matcher:function(a){return a.data("uri")},run:function(b){var c=a.Deferred(),d=b.data("uri");return this.router.registerView(d,b),c.resolve().promise()}}),a.set("xin.directive.URIDirective",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a};_.extend(b.prototype,{newRef:function(){return this.ref=this.ref||0,"bind-"+this.ref++},matcher:function(a){return a.data("bind")},run:function(b){var c=a.Deferred(),d=(this.app,this),e=b.hasClass("xin-role")?b:b.parents(".xin-role"),f=e.data("instance"),g=b.data("bind").trim().split(/\s+/);return _.each(g,function(a){var c,e,g;a=a.split(":"),a.length>1&&(c=a[0],g=a[1],g=f[g]||d.app.get(g),_.isFunction(g)&&(e=d.newRef(),b.attr("data-bind-ref",e),g=_.bind(g,f),f.$el.on(c,"[data-bind-ref="+e+"]",g)))}),c.resolve(),c.promise()}}),a.set("xin.directive.BindDirective",b)}(window.xin),function(a){"use strict";var b=function(c){var d;this.id=c.id=c.id||"default",this.app=c.app,d=a.$(c.el),this.$el=d.clone(),this.$el.find("[data-region]").addClass(function(){return"xin-region-"+a.$(this).data("region")}),d.remove(),b.get(this.app,this.id)||b.put(this.app,this.id,this)};_.extend(b.prototype,{apply:function(a){var b=this.$el.clone();b.find("[data-region=body]").html(a.html()),a.data("title")&&b.find("[data-region=title]").html(a.data("title")),a.html(b.html()),a.addClass(b.attr("class"))}}),b.get=function(a,b){var c=a.get("_layout."+b);return c},b.put=function(a,b,c){a.set("_layout."+b,c)},a.set("xin.ui.Layout",b)}(window.xin),function(a){"use strict";var b=Backbone.View.extend({initialize:function(b){var c=b.app;this.template=b.template||null,b.layout&&a.ui.Layout.get(c,b.layout).apply(this.$el)},render:function(){return this.template&&this.$el.html(this.template(this)),this}});a.set("xin.ui.Outlet",b)}(window.xin),function(a){"use strict";var b=Backbone.View.extend({}),c=b.extend({initialize:function(a){this.constructor.__super__.initialize.apply(this,arguments),this.transition=a.transition||"plain",this.activePage=null,this.pages={},(!a.app.router.mainViewport||a.mainViewport)&&(a.app.router.mainViewport=this.$el),this.$el.addClass("xin-pane")},addChild:function(a){var b={};return b[a.cid]=a,_.extend(this.pages,b),this.pageKeys=_.keys(this.pages),this.pageValues=_.values(this.pages),a.parent=this,this},showChild:function(b){var c=-1,d=-1,e=a.Deferred();return this.activePage==b?e.resolve().promise():(b&&(c=_.indexOf(this.pageValues,b)),this.activePage&&(d=_.indexOf(this.pageValues,this.activePage)),this.$el.scrollTop(0),a.ui.Pane.transitions[this.transition](this,b,this.activePage,d-c).done(e.resolve),this.activePage=b,e.promise())}});_.extend(c,{transitions:{plain:function(b,c,d){var e=a.Deferred();return d&&d.$el.removeClass("xin-show"),c.$el.addClass("xin-show"),e.resolve(),e.promise()},slide:function(b,c,d,e){var f,g,h,i=a.Deferred();return f=0>e?"left":"right",c&&(g=new a.fx.SlideIn(c.$el,f)),d&&(h=new a.fx.SlideOut(d.$el,f)),g&&g.play(),h&&h.play().then(function(){a.$(this).removeClass("xin-show"),_.defer(i.resolve)}),i.promise()}}}),a.set("xin.ui.Container",b),a.set("xin.ui.Pane",c)}(window.xin),function(a){"use strict";var b=a.ui.Outlet.extend({initialize:function(a){this.$el.addClass("xin-list"),this.itemTemplate=a.template||_.template("<li><%= model %></li>")},render:function(){var a=this;this.collection&&this.collection.each(function(c){var d=new b.Item({template:a.itemTemplate,model:c});a.$el.append(d.render().$el)})}});b.Item=a.ui.Outlet.extend({render:function(){return this.$el=a.$(this.template(this)),this}}),a.set("xin.ui.List",b)}(window.xin),function(a){"use strict";var b=a.ui.Outlet.extend({initialize:function(b){b.layout&&a.ui.Layout.get(app,b.layout).apply(this.$el),this.$el.addClass("xin-drawer").css("-webkit-transform","translateX(-100%)"),this.$el.on("click","a",_.bind(this.clicked,this))},show:function(){this.$el.css("-webkit-transform","")},hide:function(){this.$el.css("-webkit-transform","translateX(-100%)")},clicked:function(){this.hide()}});a.set("xin.ui.Drawer",b)}(window.xin);