{"version":3,"sources":["webpack:///./components/repeat.js"],"names":["xin","require","FILTER_ALL","Repeat","rowProto","base","is","templateHost","__set","set","name","value","nameSegments","split","as","indexAs","apply","arguments","__host","__get","get","content","HTMLTemplateElement","decorate","self","Row","item","index","row","fragment","document","importNode","__root","dom","childNodes","map","node","__model","__index","__item","__initialize","__parent","__parseAnnotations","prototype","element","parentElement","filter","__itemsChanged","items","rows","length","forEach","__children","removeChild","createDocumentFragment","__insertRow","appendChild","push","err","console","error","stack","bind","insertBefore","type","Array","observer","String","Object","Component","define","extends","module","exports"],"mappings":"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","file":"components/repeat.js","sourcesContent":["/* globals HTMLTemplateElement  */\n\nconst xin = require('../');\n\nconst FILTER_ALL = () => true;\n\nclass Repeat extends xin.Component {\n  get props () {\n    return {\n      items: {\n        type: Array,\n        observer: '__itemsChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'item',\n      },\n\n      indexAs: {\n        type: String,\n        value: 'index',\n      },\n\n      filter: {\n        type: Object,\n        observer: '_filterChanged',\n      },\n    };\n  }\n\n  created () {\n    this.rowProto = xin.base({\n      is: '$xin-repeat-row',\n    });\n\n    var templateHost = this;\n    var __set = this.rowProto.set;\n    this.rowProto.set = function (name, value) {\n      var nameSegments = name.split('.');\n      switch (nameSegments[0]) {\n        case templateHost.as:\n        case templateHost.indexAs:\n          return __set.apply(this, arguments);\n        default:\n          // var oldValue = this.__host.get(name);\n          return this.__host.set(name, value);\n      }\n    };\n\n    var __get = this.rowProto.get;\n    this.rowProto.get = function (name) {\n      var nameSegments = name.split('.');\n      switch (nameSegments[0]) {\n        case templateHost.as:\n        case templateHost.indexAs:\n          return __get.apply(this, arguments);\n        default:\n          return this.__host.get(name);\n      }\n    };\n\n    if (!this.content && HTMLTemplateElement.decorate) {\n      HTMLTemplateElement.decorate(this);\n    }\n\n    // Row is class to create new row\n    var self = this;\n    this.Row = function (item, index) {\n      var row = this;\n      var fragment = this.fragment = document.importNode(self.content, true);\n      this.__root = xin.dom(fragment).childNodes.map(function (node) {\n        node.__model = row;\n        node.__index = index;\n        node.__item = item;\n        return node;\n      });\n\n      this.__initialize();\n\n      this.__host = self.__parent;\n\n      this.__parseAnnotations();\n\n      this.set(self.as, item);\n\n      // if (self.parentElement) {\n      //  xin.dom(self.parentElement).insertBefore(fragment, self);\n      // }\n    };\n    this.Row.prototype = this.rowProto;\n  }\n\n  itemForElement (element) {\n    while (element && !element.__model) {\n      element = element.parentElement;\n    }\n    return element.__item;\n  }\n\n  indexForElement (element) {\n    while (element && !element.__model) {\n      element = element.parentElement;\n    }\n    return element.__index;\n  }\n\n  modelForElement (element) {\n    while (element && !element.__model) {\n      element = element.parentElement;\n    }\n    return element.__model;\n  }\n\n  _filterChanged (filter) {\n    if (typeof filter !== 'function') {\n      return;\n    }\n\n    this.__itemsChanged(this.items);\n  }\n\n  __insertRow (item, index) {\n    // var fragment = document.importNode(this.content, true);\n    // var row = {\n    //  __root: xin.dom(fragment).childNodes\n    // };\n\n    // row.__root.forEach(function(node) {\n    //  node.__model = row;\n    //  node.__index = index;\n    //  node.__item = item;\n    // });\n\n    // Object.setPrototypeOf(row, this.rowProto);\n\n    // row.__initialize();\n\n    // row.__host = this.__parent;\n\n    // row.__parseAnnotations();\n\n    // row.set(this.as, item);\n\n    // if (this.parentElement) {\n    //  xin.dom(this.parentElement).insertBefore(fragment, this);\n    // }\n\n    var row = new this.Row(item, index);\n\n    return row;\n  }\n\n  __itemsChanged (items /* , oldItems */) {\n    if (this.rows && this.rows.length) {\n      this.rows.forEach(function (row) {\n        row.__children.forEach(function (node) {\n          node.parentElement.removeChild(node);\n        });\n      });\n    }\n\n    this.rows = [];\n\n    // when no items rows must be empty\n    if (!items) {\n      return;\n    }\n\n    var filter = this.filter || FILTER_ALL;\n\n    var fragment = document.createDocumentFragment();\n    items.filter(filter).forEach(function (item, index) {\n      try {\n        var row = this.__insertRow(item, index);\n        fragment.appendChild(row.fragment);\n        this.rows.push(row);\n      } catch (err) {\n        console.error(err.stack);\n      }\n    }.bind(this));\n\n    if (this.parentElement) {\n      xin.dom(this.parentElement).insertBefore(fragment, this);\n    }\n  }\n}\n\nxin.define('xin-repeat', Repeat, { extends: 'template' });\nxin.Repeat = Repeat;\n\nmodule.exports = Repeat;\n\n\n\n/** WEBPACK FOOTER **\n ** ./components/repeat.js\n **/"],"sourceRoot":""}