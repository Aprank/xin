{"version":3,"sources":["webpack:///./components/repeat.js"],"names":["FILTER_ALL","RepeatRow","constructor","repeat","item","index","__templateInitialize","__templateModel","is","__id","__templateId","__repeat","__repeatAs","as","__repeatIndexAs","indexAs","__templateChildNodes","forEach","node","nodeType","window","Node","ELEMENT_NODE","__repeatModel","update","__templateRender","notify","set","path","value","__templateGetPathAsArray","__templateHost","get","Repeat","xin","base","props","items","type","Array","observer","String","filter","Function","__initTemplate","T","prototype","call","_itemsChanged","rows","len","length","push","splice","row","__templateUninitialize","itemForElement","element","parentElement","indexForElement","modelForElement","_filterChanged","define","extends"],"mappings":"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","file":"components/repeat.js","sourcesContent":["import T from 'template-binding';\n\nimport xin from '../';\n\nconst FILTER_ALL = () => true;\n\nclass RepeatRow extends T {\n  constructor (repeat, item, index) {\n    super();\n\n    // override T constructor\n    this.__templateInitialize(repeat, repeat.__templateModel, repeat);\n\n    this.is = '$repeat-row';\n    this.__id = this.__templateId;\n\n    this.__repeat = repeat;\n    this.__repeatAs = repeat.as;\n    this.__repeatIndexAs = repeat.indexAs;\n\n    this.__templateChildNodes.forEach(node => {\n      if (node.nodeType === window.Node.ELEMENT_NODE) {\n        node.__repeatModel = this;\n      }\n    });\n\n    this.update(item, index);\n\n    this.__templateRender();\n  }\n\n  update (item, index) {\n    this[this.__repeatAs] = item;\n    this[this.__repeatIndexAs] = index;\n    this.notify(this.__repeatAs, item);\n    this.notify(this.__repeatIndexAs, index);\n  }\n\n  set (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.set(path, value);\n    }\n\n    return this.__templateHost.set(path, value);\n  }\n\n  get (path) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.get(path);\n    }\n\n    return this.__templateHost.get(path);\n  }\n\n  notify (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.notify(path, value);\n    }\n\n    return this.__templateHost.notify(path, value);\n  }\n};\n\nclass Repeat extends xin.base('HTMLTemplateElement') {\n  get props () {\n    return {\n      items: {\n        type: Array,\n        observer: '_itemsChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'item',\n      },\n\n      indexAs: {\n        type: String,\n        value: 'index',\n      },\n\n      filter: {\n        type: Function,\n        observer: '_filterChanged',\n      },\n    };\n  }\n\n  __initTemplate () {\n    T.prototype.__templateInitialize.call(this, null, this);\n  }\n\n  _itemsChanged (items) {\n    this.rows = this.rows || [];\n\n    let len = 0;\n\n    if (items && items.length) {\n      let filter = this.filter || FILTER_ALL;\n      items.forEach((item, index) => {\n        if (filter(item)) {\n          if (this.rows[index]) {\n            this.rows[index].update(item, index);\n          } else {\n            this.rows.push(new RepeatRow(this, item, index));\n          }\n\n          len++;\n        }\n      });\n    }\n\n    // move to detach\n    this.rows.splice(len).forEach(row => {\n      row.__templateUninitialize();\n    });\n  }\n\n  itemForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.as);\n  }\n\n  indexForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.indexAs);\n  }\n\n  modelForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel;\n  }\n\n  _filterChanged (filter) {\n    if (typeof filter !== 'function') {\n      return;\n    }\n\n    this._itemsChanged(this.items);\n  }\n}\n\nxin.define('xin-repeat', Repeat, { extends: 'template' });\n\nexport default Repeat;\n\n\n\n// WEBPACK FOOTER //\n// ./components/repeat.js"],"sourceRoot":""}