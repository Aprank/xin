{"version":3,"sources":["webpack:///./components/repeat.js"],"names":["xin","require","T","FILTER_ALL","RepeatRow","repeat","item","index","__templateModel","__repeat","__repeatAs","as","__repeatIndexAs","indexAs","__templateChildNodes","forEach","node","nodeType","Node","ELEMENT_NODE","__repeatModel","update","render","notify","path","value","__templateGetPathAsArray","__templateHost","set","get","Repeat","prototype","__templateInitialize","call","items","rows","len","length","filter","push","splice","row","__templateUninitialize","element","parentElement","_itemsChanged","type","Array","observer","String","Object","base","define","extends","module","exports"],"mappings":"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","file":"components/repeat.js","sourcesContent":["/* globals Node */\n\nconst xin = require('../src');\nconst T = require('template-binding');\n\nconst FILTER_ALL = () => true;\n\nclass RepeatRow extends T {\n  constructor (repeat, item, index) {\n    super(repeat, repeat.__templateModel, repeat);\n\n    this.__repeat = repeat;\n    this.__repeatAs = repeat.as;\n    this.__repeatIndexAs = repeat.indexAs;\n\n    this.__templateChildNodes.forEach(node => {\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        node.__repeatModel = this;\n      }\n    });\n\n    this.update(item, index);\n\n    this.render();\n  }\n\n  update (item, index) {\n    this[this.__repeatAs] = item;\n    this[this.__repeatIndexAs] = index;\n    this.notify(this.__repeatAs, item);\n    this.notify(this.__repeatIndexAs, index);\n  }\n\n  set (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.set(path, value);\n    }\n\n    return this.__templateHost.set(path, value);\n  }\n\n  get (path) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.get(path);\n    }\n\n    return this.__templateHost.get(path);\n  }\n\n  notify (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.notify(path, value);\n    }\n\n    return this.__templateHost.notify(path, value);\n  }\n};\n\nclass Repeat extends xin.base('HTMLTemplateElement') {\n  get props () {\n    return {\n      items: {\n        type: Array,\n        observer: '_itemsChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'item',\n      },\n\n      indexAs: {\n        type: String,\n        value: 'index',\n      },\n\n      filter: {\n        type: Object,\n        observer: '_filterChanged',\n      },\n    };\n  }\n\n  __initTemplate () {\n    T.prototype.__templateInitialize.call(this, null, this);\n  }\n\n  _itemsChanged (items) {\n    this.rows = this.rows || [];\n\n    let len = 0;\n\n    if (items && items.length) {\n      let filter = this.filter || FILTER_ALL;\n      items.forEach((item, index) => {\n        if (filter(item)) {\n          if (this.rows[index]) {\n            this.rows[index].update(item, index);\n          } else {\n            this.rows.push(new RepeatRow(this, item, index));\n          }\n\n          len++;\n        }\n      });\n    }\n\n    this.rows.splice(len).forEach(row => {\n      row.__templateUninitialize();\n    });\n  }\n\n  itemForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.as);\n  }\n\n  indexForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.indexAs);\n  }\n\n  modelForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel;\n  }\n\n  _filterChanged (filter) {\n    if (typeof filter !== 'function') {\n      return;\n    }\n\n    this._itemsChanged(this.items);\n  }\n}\n\nxin.define('xin-repeat', Repeat, { extends: 'template' });\nxin.Repeat = Repeat;\n\nmodule.exports = Repeat;\n\n\n\n/** WEBPACK FOOTER **\n ** ./components/repeat.js\n **/"],"sourceRoot":""}