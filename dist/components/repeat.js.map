{"version":3,"sources":["webpack:///./components/repeat.js"],"names":["FILTER_ALL","RepeatRow","repeat","item","index","__templateInitialize","__templateModel","is","__id","__templateId","__repeat","__repeatAs","as","__repeatIndexAs","indexAs","__templateChildNodes","forEach","node","nodeType","window","Node","ELEMENT_NODE","__repeatModel","update","__templateRender","notify","path","value","__templateGetPathAsArray","__templateHost","set","get","Repeat","prototype","call","items","rows","len","length","filter","push","splice","element","parentElement","_itemsChanged","type","Array","observer","String","Object","base","define","extends"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;AAEA,KAAMA,aAAa,SAAbA,UAAa;AAAA,UAAM,IAAN;AAAA,EAAnB;;KAEMC,S;;;AACJ,sBAAaC,MAAb,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkC;AAAA;;AAGhC;AAHgC;;AAIhC,WAAKC,oBAAL,CAA0BH,MAA1B,EAAkCA,OAAOI,eAAzC,EAA0DJ,MAA1D;;AAEA,WAAKK,EAAL,GAAU,aAAV;AACA,WAAKC,IAAL,GAAY,MAAKC,YAAjB;;AAEA,WAAKC,QAAL,GAAgBR,MAAhB;AACA,WAAKS,UAAL,GAAkBT,OAAOU,EAAzB;AACA,WAAKC,eAAL,GAAuBX,OAAOY,OAA9B;;AAEA,WAAKC,oBAAL,CAA0BC,OAA1B,CAAkC,gBAAQ;AACxC,WAAIC,KAAKC,QAAL,KAAkBC,OAAOC,IAAP,CAAYC,YAAlC,EAAgD;AAC9CJ,cAAKK,aAAL;AACD;AACF,MAJD;;AAMA,WAAKC,MAAL,CAAYpB,IAAZ,EAAkBC,KAAlB;;AAEA,WAAKoB,gBAAL;AArBgC;AAsBjC;;;;4BAEOrB,I,EAAMC,K,EAAO;AACnB,YAAK,KAAKO,UAAV,IAAwBR,IAAxB;AACA,YAAK,KAAKU,eAAV,IAA6BT,KAA7B;AACA,YAAKqB,MAAL,CAAY,KAAKd,UAAjB,EAA6BR,IAA7B;AACA,YAAKsB,MAAL,CAAY,KAAKZ,eAAjB,EAAkCT,KAAlC;AACD;;;yBAEIsB,I,EAAMC,K,EAAO;AAChBD,cAAO,KAAKE,wBAAL,CAA8BF,IAA9B,CAAP;;AAEA,WAAIA,KAAK,CAAL,MAAY,KAAKf,UAAjB,IAA+Be,KAAK,CAAL,MAAY,KAAKb,eAApD,EAAqE;AACnE,0HAAiBa,IAAjB,EAAuBC,KAAvB;AACD;;AAED,cAAO,KAAKE,cAAL,CAAoBC,GAApB,CAAwBJ,IAAxB,EAA8BC,KAA9B,CAAP;AACD;;;yBAEID,I,EAAM;AACTA,cAAO,KAAKE,wBAAL,CAA8BF,IAA9B,CAAP;;AAEA,WAAIA,KAAK,CAAL,MAAY,KAAKf,UAAjB,IAA+Be,KAAK,CAAL,MAAY,KAAKb,eAApD,EAAqE;AACnE,0HAAiBa,IAAjB;AACD;;AAED,cAAO,KAAKG,cAAL,CAAoBE,GAApB,CAAwBL,IAAxB,CAAP;AACD;;;4BAEOA,I,EAAMC,K,EAAO;AACnBD,cAAO,KAAKE,wBAAL,CAA8BF,IAA9B,CAAP;;AAEA,WAAIA,KAAK,CAAL,MAAY,KAAKf,UAAjB,IAA+Be,KAAK,CAAL,MAAY,KAAKb,eAApD,EAAqE;AACnE,6HAAoBa,IAApB,EAA0BC,KAA1B;AACD;;AAED,cAAO,KAAKE,cAAL,CAAoBJ,MAApB,CAA2BC,IAA3B,EAAiCC,KAAjC,CAAP;AACD;;;;;;AACF;;KAEKK,M;;;;;;;;;;;sCAyBc;AAChB,iCAAEC,SAAF,CAAY5B,oBAAZ,CAAiC6B,IAAjC,CAAsC,IAAtC,EAA4C,IAA5C,EAAkD,IAAlD;AACD;;;mCAEcC,K,EAAO;AAAA;;AACpB,YAAKC,IAAL,GAAY,KAAKA,IAAL,IAAa,EAAzB;;AAEA,WAAIC,MAAM,CAAV;;AAEA,WAAIF,SAASA,MAAMG,MAAnB,EAA2B;AAAA;AACzB,eAAIC,SAAS,OAAKA,MAAL,IAAevC,UAA5B;AACAmC,iBAAMnB,OAAN,CAAc,UAACb,IAAD,EAAOC,KAAP,EAAiB;AAC7B,iBAAImC,OAAOpC,IAAP,CAAJ,EAAkB;AAChB,mBAAI,OAAKiC,IAAL,CAAUhC,KAAV,CAAJ,EAAsB;AACpB,wBAAKgC,IAAL,CAAUhC,KAAV,EAAiBmB,MAAjB,CAAwBpB,IAAxB,EAA8BC,KAA9B;AACD,gBAFD,MAEO;AACL,wBAAKgC,IAAL,CAAUI,IAAV,CAAe,IAAIvC,SAAJ,SAAoBE,IAApB,EAA0BC,KAA1B,CAAf;AACD;;AAEDiC;AACD;AACF,YAVD;AAFyB;AAa1B;;AAED,YAAKD,IAAL,CAAUK,MAAV,CAAiBJ,GAAjB;;AAEA;AACA;AACA;AACA;AACD;;;oCAEeK,O,EAAS;AACvB,cAAOA,WAAW,CAACA,QAAQpB,aAA3B,EAA0C;AACxCoB,mBAAUA,QAAQC,aAAlB;AACD;AACD,cAAOD,QAAQpB,aAAR,CAAsBS,GAAtB,CAA0B,KAAKnB,EAA/B,CAAP;AACD;;;qCAEgB8B,O,EAAS;AACxB,cAAOA,WAAW,CAACA,QAAQpB,aAA3B,EAA0C;AACxCoB,mBAAUA,QAAQC,aAAlB;AACD;AACD,cAAOD,QAAQpB,aAAR,CAAsBS,GAAtB,CAA0B,KAAKjB,OAA/B,CAAP;AACD;;;qCAEgB4B,O,EAAS;AACxB,cAAOA,WAAW,CAACA,QAAQpB,aAA3B,EAA0C;AACxCoB,mBAAUA,QAAQC,aAAlB;AACD;AACD,cAAOD,QAAQpB,aAAf;AACD;;;oCAEeiB,M,EAAQ;AACtB,WAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AAChC;AACD;;AAED,YAAKK,aAAL,CAAmB,KAAKT,KAAxB;AACD;;;yBAnFY;AACX,cAAO;AACLA,gBAAO;AACLU,iBAAMC,KADD;AAELC,qBAAU;AAFL,UADF;;AAMLnC,aAAI;AACFiC,iBAAMG,MADJ;AAEFrB,kBAAO;AAFL,UANC;;AAWLb,kBAAS;AACP+B,iBAAMG,MADC;AAEPrB,kBAAO;AAFA,UAXJ;;AAgBLY,iBAAQ;AACNM,iBAAMI,MADA;AAENF,qBAAU;AAFJ;AAhBH,QAAP;AAqBD;;;;GAvBkB,cAAIG,IAAJ,CAAS,qBAAT,C;;AAuFrB,eAAIC,MAAJ,CAAW,YAAX,EAAyBnB,MAAzB,EAAiC,EAAEoB,SAAS,UAAX,EAAjC;AACA,eAAIpB,MAAJ,GAAaA,MAAb;;mBAEeA,M","file":"components/repeat.js","sourcesContent":["import xin from '../src';\nimport T from 'template-binding';\n\nconst FILTER_ALL = () => true;\n\nclass RepeatRow extends T {\n  constructor (repeat, item, index) {\n    super();\n\n    // override T constructor\n    this.__templateInitialize(repeat, repeat.__templateModel, repeat);\n\n    this.is = '$repeat-row';\n    this.__id = this.__templateId;\n\n    this.__repeat = repeat;\n    this.__repeatAs = repeat.as;\n    this.__repeatIndexAs = repeat.indexAs;\n\n    this.__templateChildNodes.forEach(node => {\n      if (node.nodeType === window.Node.ELEMENT_NODE) {\n        node.__repeatModel = this;\n      }\n    });\n\n    this.update(item, index);\n\n    this.__templateRender();\n  }\n\n  update (item, index) {\n    this[this.__repeatAs] = item;\n    this[this.__repeatIndexAs] = index;\n    this.notify(this.__repeatAs, item);\n    this.notify(this.__repeatIndexAs, index);\n  }\n\n  set (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.set(path, value);\n    }\n\n    return this.__templateHost.set(path, value);\n  }\n\n  get (path) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.get(path);\n    }\n\n    return this.__templateHost.get(path);\n  }\n\n  notify (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.notify(path, value);\n    }\n\n    return this.__templateHost.notify(path, value);\n  }\n};\n\nclass Repeat extends xin.base('HTMLTemplateElement') {\n  get props () {\n    return {\n      items: {\n        type: Array,\n        observer: '_itemsChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'item',\n      },\n\n      indexAs: {\n        type: String,\n        value: 'index',\n      },\n\n      filter: {\n        type: Object,\n        observer: '_filterChanged',\n      },\n    };\n  }\n\n  __initTemplate () {\n    T.prototype.__templateInitialize.call(this, null, this);\n  }\n\n  _itemsChanged (items) {\n    this.rows = this.rows || [];\n\n    let len = 0;\n\n    if (items && items.length) {\n      let filter = this.filter || FILTER_ALL;\n      items.forEach((item, index) => {\n        if (filter(item)) {\n          if (this.rows[index]) {\n            this.rows[index].update(item, index);\n          } else {\n            this.rows.push(new RepeatRow(this, item, index));\n          }\n\n          len++;\n        }\n      });\n    }\n\n    this.rows.splice(len);\n\n    // move to detach\n    // this.rows.splice(len).forEach(row => {\n    //   row.__templateUninitialize();\n    // });\n  }\n\n  itemForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.as);\n  }\n\n  indexForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.indexAs);\n  }\n\n  modelForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel;\n  }\n\n  _filterChanged (filter) {\n    if (typeof filter !== 'function') {\n      return;\n    }\n\n    this._itemsChanged(this.items);\n  }\n}\n\nxin.define('xin-repeat', Repeat, { extends: 'template' });\nxin.Repeat = Repeat;\n\nexport default Repeat;\n\n\n\n// WEBPACK FOOTER //\n// ./components/repeat.js"],"sourceRoot":""}