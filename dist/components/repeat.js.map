{"version":3,"sources":["webpack:///./components/repeat.js"],"names":["FILTER_ALL","RepeatRow","repeat","item","index","__templateInitialize","__templateModel","is","__id","__templateId","__repeat","__repeatAs","as","__repeatIndexAs","indexAs","__templateChildNodes","forEach","node","nodeType","window","Node","ELEMENT_NODE","__repeatModel","update","__templateRender","notify","path","value","__templateGetPathAsArray","__templateHost","set","get","Repeat","prototype","call","items","rows","len","length","filter","push","splice","row","__templateUninitialize","element","parentElement","_itemsChanged","type","Array","observer","String","Function","base","define","extends"],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;AAEA,IAAMA,aAAa,SAAbA,UAAa;AAAA,SAAM,IAAN;AAAA,CAAnB;;IAEMC,S;;;AACJ,qBAAaC,MAAb,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkC;AAAA;;AAGhC;AAHgC;;AAIhC,UAAKC,oBAAL,CAA0BH,MAA1B,EAAkCA,OAAOI,eAAzC,EAA0DJ,MAA1D;;AAEA,UAAKK,EAAL,GAAU,aAAV;AACA,UAAKC,IAAL,GAAY,MAAKC,YAAjB;;AAEA,UAAKC,QAAL,GAAgBR,MAAhB;AACA,UAAKS,UAAL,GAAkBT,OAAOU,EAAzB;AACA,UAAKC,eAAL,GAAuBX,OAAOY,OAA9B;;AAEA,UAAKC,oBAAL,CAA0BC,OAA1B,CAAkC,gBAAQ;AACxC,UAAIC,KAAKC,QAAL,KAAkBC,OAAOC,IAAP,CAAYC,YAAlC,EAAgD;AAC9CJ,aAAKK,aAAL;AACD;AACF,KAJD;;AAMA,UAAKC,MAAL,CAAYpB,IAAZ,EAAkBC,KAAlB;;AAEA,UAAKoB,gBAAL;AArBgC;AAsBjC;;;;2BAEOrB,I,EAAMC,K,EAAO;AACnB,WAAK,KAAKO,UAAV,IAAwBR,IAAxB;AACA,WAAK,KAAKU,eAAV,IAA6BT,KAA7B;AACA,WAAKqB,MAAL,CAAY,KAAKd,UAAjB,EAA6BR,IAA7B;AACA,WAAKsB,MAAL,CAAY,KAAKZ,eAAjB,EAAkCT,KAAlC;AACD;;;wBAEIsB,I,EAAMC,K,EAAO;AAChBD,aAAO,KAAKE,wBAAL,CAA8BF,IAA9B,CAAP;;AAEA,UAAIA,KAAK,CAAL,MAAY,KAAKf,UAAjB,IAA+Be,KAAK,CAAL,MAAY,KAAKb,eAApD,EAAqE;AACnE,yHAAiBa,IAAjB,EAAuBC,KAAvB;AACD;;AAED,aAAO,KAAKE,cAAL,CAAoBC,GAApB,CAAwBJ,IAAxB,EAA8BC,KAA9B,CAAP;AACD;;;wBAEID,I,EAAM;AACTA,aAAO,KAAKE,wBAAL,CAA8BF,IAA9B,CAAP;;AAEA,UAAIA,KAAK,CAAL,MAAY,KAAKf,UAAjB,IAA+Be,KAAK,CAAL,MAAY,KAAKb,eAApD,EAAqE;AACnE,yHAAiBa,IAAjB;AACD;;AAED,aAAO,KAAKG,cAAL,CAAoBE,GAApB,CAAwBL,IAAxB,CAAP;AACD;;;2BAEOA,I,EAAMC,K,EAAO;AACnBD,aAAO,KAAKE,wBAAL,CAA8BF,IAA9B,CAAP;;AAEA,UAAIA,KAAK,CAAL,MAAY,KAAKf,UAAjB,IAA+Be,KAAK,CAAL,MAAY,KAAKb,eAApD,EAAqE;AACnE,4HAAoBa,IAApB,EAA0BC,KAA1B;AACD;;AAED,aAAO,KAAKE,cAAL,CAAoBJ,MAApB,CAA2BC,IAA3B,EAAiCC,KAAjC,CAAP;AACD;;;;;;AACF;;IAEKK,M;;;;;;;;;;;qCAyBc;AAChB,gCAAEC,SAAF,CAAY5B,oBAAZ,CAAiC6B,IAAjC,CAAsC,IAAtC,EAA4C,IAA5C,EAAkD,IAAlD;AACD;;;kCAEcC,K,EAAO;AAAA;;AACpB,WAAKC,IAAL,GAAY,KAAKA,IAAL,IAAa,EAAzB;;AAEA,UAAIC,MAAM,CAAV;;AAEA,UAAIF,SAASA,MAAMG,MAAnB,EAA2B;AAAA;AACzB,cAAIC,SAAS,OAAKA,MAAL,IAAevC,UAA5B;AACAmC,gBAAMnB,OAAN,CAAc,UAACb,IAAD,EAAOC,KAAP,EAAiB;AAC7B,gBAAImC,OAAOpC,IAAP,CAAJ,EAAkB;AAChB,kBAAI,OAAKiC,IAAL,CAAUhC,KAAV,CAAJ,EAAsB;AACpB,uBAAKgC,IAAL,CAAUhC,KAAV,EAAiBmB,MAAjB,CAAwBpB,IAAxB,EAA8BC,KAA9B;AACD,eAFD,MAEO;AACL,uBAAKgC,IAAL,CAAUI,IAAV,CAAe,IAAIvC,SAAJ,SAAoBE,IAApB,EAA0BC,KAA1B,CAAf;AACD;;AAEDiC;AACD;AACF,WAVD;AAFyB;AAa1B;;AAED;AACA,WAAKD,IAAL,CAAUK,MAAV,CAAiBJ,GAAjB,EAAsBrB,OAAtB,CAA8B,eAAO;AACnC0B,YAAIC,sBAAJ;AACD,OAFD;AAGD;;;mCAEeC,O,EAAS;AACvB,aAAOA,WAAW,CAACA,QAAQtB,aAA3B,EAA0C;AACxCsB,kBAAUA,QAAQC,aAAlB;AACD;AACD,aAAOD,QAAQtB,aAAR,CAAsBS,GAAtB,CAA0B,KAAKnB,EAA/B,CAAP;AACD;;;oCAEgBgC,O,EAAS;AACxB,aAAOA,WAAW,CAACA,QAAQtB,aAA3B,EAA0C;AACxCsB,kBAAUA,QAAQC,aAAlB;AACD;AACD,aAAOD,QAAQtB,aAAR,CAAsBS,GAAtB,CAA0B,KAAKjB,OAA/B,CAAP;AACD;;;oCAEgB8B,O,EAAS;AACxB,aAAOA,WAAW,CAACA,QAAQtB,aAA3B,EAA0C;AACxCsB,kBAAUA,QAAQC,aAAlB;AACD;AACD,aAAOD,QAAQtB,aAAf;AACD;;;mCAEeiB,M,EAAQ;AACtB,UAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AAChC;AACD;;AAED,WAAKO,aAAL,CAAmB,KAAKX,KAAxB;AACD;;;wBAjFY;AACX,aAAO;AACLA,eAAO;AACLY,gBAAMC,KADD;AAELC,oBAAU;AAFL,SADF;;AAMLrC,YAAI;AACFmC,gBAAMG,MADJ;AAEFvB,iBAAO;AAFL,SANC;;AAWLb,iBAAS;AACPiC,gBAAMG,MADC;AAEPvB,iBAAO;AAFA,SAXJ;;AAgBLY,gBAAQ;AACNQ,gBAAMI,QADA;AAENF,oBAAU;AAFJ;AAhBH,OAAP;AAqBD;;;;EAvBkB,cAAIG,IAAJ,CAAS,qBAAT,C;;AAqFrB,cAAIC,MAAJ,CAAW,YAAX,EAAyBrB,MAAzB,EAAiC,EAAEsB,SAAS,UAAX,EAAjC;AACA;;kBAEetB,M","file":"components/repeat.js","sourcesContent":["import xin from '../src';\nimport T from 'template-binding';\n\nconst FILTER_ALL = () => true;\n\nclass RepeatRow extends T {\n  constructor (repeat, item, index) {\n    super();\n\n    // override T constructor\n    this.__templateInitialize(repeat, repeat.__templateModel, repeat);\n\n    this.is = '$repeat-row';\n    this.__id = this.__templateId;\n\n    this.__repeat = repeat;\n    this.__repeatAs = repeat.as;\n    this.__repeatIndexAs = repeat.indexAs;\n\n    this.__templateChildNodes.forEach(node => {\n      if (node.nodeType === window.Node.ELEMENT_NODE) {\n        node.__repeatModel = this;\n      }\n    });\n\n    this.update(item, index);\n\n    this.__templateRender();\n  }\n\n  update (item, index) {\n    this[this.__repeatAs] = item;\n    this[this.__repeatIndexAs] = index;\n    this.notify(this.__repeatAs, item);\n    this.notify(this.__repeatIndexAs, index);\n  }\n\n  set (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.set(path, value);\n    }\n\n    return this.__templateHost.set(path, value);\n  }\n\n  get (path) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.get(path);\n    }\n\n    return this.__templateHost.get(path);\n  }\n\n  notify (path, value) {\n    path = this.__templateGetPathAsArray(path);\n\n    if (path[0] === this.__repeatAs || path[0] === this.__repeatIndexAs) {\n      return super.notify(path, value);\n    }\n\n    return this.__templateHost.notify(path, value);\n  }\n};\n\nclass Repeat extends xin.base('HTMLTemplateElement') {\n  get props () {\n    return {\n      items: {\n        type: Array,\n        observer: '_itemsChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'item',\n      },\n\n      indexAs: {\n        type: String,\n        value: 'index',\n      },\n\n      filter: {\n        type: Function,\n        observer: '_filterChanged',\n      },\n    };\n  }\n\n  __initTemplate () {\n    T.prototype.__templateInitialize.call(this, null, this);\n  }\n\n  _itemsChanged (items) {\n    this.rows = this.rows || [];\n\n    let len = 0;\n\n    if (items && items.length) {\n      let filter = this.filter || FILTER_ALL;\n      items.forEach((item, index) => {\n        if (filter(item)) {\n          if (this.rows[index]) {\n            this.rows[index].update(item, index);\n          } else {\n            this.rows.push(new RepeatRow(this, item, index));\n          }\n\n          len++;\n        }\n      });\n    }\n\n    // move to detach\n    this.rows.splice(len).forEach(row => {\n      row.__templateUninitialize();\n    });\n  }\n\n  itemForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.as);\n  }\n\n  indexForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel.get(this.indexAs);\n  }\n\n  modelForElement (element) {\n    while (element && !element.__repeatModel) {\n      element = element.parentElement;\n    }\n    return element.__repeatModel;\n  }\n\n  _filterChanged (filter) {\n    if (typeof filter !== 'function') {\n      return;\n    }\n\n    this._itemsChanged(this.items);\n  }\n}\n\nxin.define('xin-repeat', Repeat, { extends: 'template' });\n// xin.Repeat = Repeat;\n\nexport default Repeat;\n\n\n\n// WEBPACK FOOTER //\n// ./components/repeat.js"],"sourceRoot":""}