webpackJsonp([0],[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){function n(a,i){try{var o=e[a](i),u=o.value}catch(t){return void r(t)}return o.done?void t(u):Promise.resolve(u).then(function(t){n("next",t)},function(t){n("throw",t)})}return n("next")})}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=this,r=!0,n=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s=o.value;if("function"!=typeof s)throw new TypeError("Middleware must be composed of functions!")}}catch(t){n=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(n)throw i}}return function(){var r=a(regeneratorRuntime.mark(function r(n,i){var o,u=function(){var e=a(regeneratorRuntime.mark(function e(r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r<=o)){e.next=2;break}throw new Error("next() called multiple times");case 2:if(o=r,a=t[r],r===t.length&&(a=i),a){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,a(n,function(){return u(r+1)});case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=-1,t.abrupt("return",u(0));case 2:case"end":return t.stop()}},r,e)}));return function(t,e){return r.apply(this,arguments)}}()}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),l=r(1),h=n(l),f=function(){},p=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),c(e,[{key:"handleRouteNotFound",value:function(t){console.error("Route not found: "+t.detail)}},{key:"_titleChanged",value:function(t){document.title=t}},{key:"created",value:function(){h.default.put("app",this),this.__appSignature=!0,this.location=window.location,this.history=window.history,this.handlers=[],this.middlewares=[],this.__awaitRouteCallback=f,this.__started=!1,this.__starting=!1}},{key:"attached",value:function(){var t=this;this.manual||this.async(function(){t.__availableUris=[].map.call(t.querySelectorAll(".xin-view"),function(t){return t.uri}),t.start()})}},{key:"__isStatic",value:function(t){return!t.match(/[[{]/)}},{key:"__routeRegExp",value:function(t){var e=t.split("[");if(e.length>2)throw new Error("Invalid use of optional params");var r=[],n=e[0].replace(/{([^}]+)}/g,function(t,e){return r.push(e),"([^/]+)"}).replace(/\//g,"\\/"),a="";return e[1]&&(a="(?:"+e[1].slice(0,-1).replace(/{([^}]+)}/g,function(t,e){return r.push(e),"([^/]+)"}).replace(/\//g,"\\/")+")?"),[new RegExp("^"+n+a+"$"),r]}},{key:"route",value:function(t,e){var r={route:t,type:"s",pattern:null,args:[],callback:e};if(!this.__isStatic(t)){var n=this.__routeRegExp(t);r.type="v",r.pattern=n[0],r.args=n[1]}this.handlers.push(r),this.__awaitRouteCallback(this.getFragmentExecutors(this.getFragment()))}},{key:"start",value:function(){function t(){return e.apply(this,arguments)}var e=a(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.__started&&!this.__starting){t.next=2;break}return t.abrupt("return");case 2:return this.__middlewareChainRun=s(this.middlewares),console.info("Starting "+this.is+":"+this.__id+" ..."),this.__starting=!0,t.next=7,this.__execute();case 7:e=t.sent,this.__starting=!1,e&&(console.info("Started "+this.is+":"+this.__id),this.__started=!0,this.__listenNavigation(),this.fire("started"));case 10:case"end":return t.stop()}},t,this)}));return t}()},{key:"__listenNavigation",value:function(){var t=this,e=function(){t.__execute()};"history"===this.mode?(h.default.event(window).on("popstate",e),h.default.event(document).on("click",function(r){if(!r.defaultPrevented&&"A"===r.target.nodeName&&""===r.target.target){r.preventDefault();var n={url:r.target.getAttribute("href")};t.history.pushState(n,r.target.innerHTML,r.target.href),e()}})):h.default.event(window).on("hashchange",e)}},{key:"getFragmentExecutors",value:function(t){return this.handlers.reduce(function(e,r){return"s"===r.type?t===r.route&&e.push({handler:r,args:{}}):"v"===r.type&&!function(){var n=t.match(r.pattern);n&&!function(){var t={};r.args.forEach(function(e,r){t[e]=n[r+1]}),e.push({handler:r,args:t})}()}(),e},[])}},{key:"__waitForRoute",value:function(){var t=this;return new Promise(function(e,r){t.__awaitRouteCallback=function(r){0!==r.length&&(t.__awaitRouteCallback=f,e(r))}})}},{key:"__execute",value:function(){function t(){return e.apply(this,arguments)}var e=a(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getFragment(),r=this.getFragmentExecutors(e),0!==r.length){t.next=9;break}if(this.__availableUris.indexOf(e)!==-1){t.next=6;break}return this.fire("route-not-found",e),t.abrupt("return",!1);case 6:return t.next=8,this.__waitForRoute();case 8:r=t.sent;case 9:return n={uri:e},this.fire("navigated",n),t.next=13,this.__middlewareChainRun(n,function(){r.forEach(function(t){t.handler.callback(t.args,n)})});case 13:return t.abrupt("return",!0);case 14:case"end":return t.stop()}},t,this)}));return t}()},{key:"navigate",value:function(t,e){if(t=t||"/",e=e||{},"history"===this.mode){var r=this.rootUri+t.toString().replace(/\/$/,"").replace(/^\//,"");this.location.href.replace(this.location.origin,"")!==r&&(this.history[e.replace?"replaceState":"pushState"]({},document.title,r),this.__execute())}else this.location.href.match(this.hashSeparator),this.location.href=this.location.href.replace(this.hashSeparator,"")+this.hashSeparator+t;return this}},{key:"use",value:function(t){this.middlewares.push(t)}},{key:"getFragment",value:function(){try{var t=void 0;if("history"===this.mode)t=decodeURI(this.location.pathname+this.location.search),t=t.replace(/\?(.*)$/,""),t="/"===this.rootUri?t:t.replace(this.rootUri,"");else{var e=this.location.href.match(this.hashSeparator);t=e?e[1]:""}return"/"+t.toString().replace(/\/$/,"").replace(/^\//,"")}catch(t){return console.error("Fragment is not match any pattern, fallback to /"),"/"}}},{key:"props",get:function(){return{docTitle:{type:String,value:"Application",observer:"_titleChanged"},manual:{type:Boolean},mode:{type:String,value:"hash"},rootUri:{type:String,value:"/"},hashSeparator:{type:RegExp,value:function(){return/#!(.*)$/}}}}},{key:"listeners",get:function(){return{"route-not-found":"handleRouteNotFound(evt)"}}},{key:"started",get:function(){return this.__started||!1}}]),e}(h.default.Component);h.default.define("xin-app",p),h.default.App=p,e.default=p}]);
//# sourceMappingURL=app.min.js.map