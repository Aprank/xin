webpackJsonp([0],[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(1),h=function(t){function e(){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),o(e,[{key:"_titleChanged",value:function(t){document.title=t}},{key:"created",value:function(){this.__appSignature=!0,this.location=window.location,this.history=window.history,this.handlers=[],this.middlewares=[],this.__started=!1,this.addEventListener("route-not-found",function(t){console.error("Route not found: "+t.detail)})}},{key:"_hashSeparatorChanged",value:function(t){this.reHashSeparator=new RegExp(t+"(.*)$")}},{key:"attached",value:function(){this.start()}},{key:"__isStatic",value:function(t){return!t.match(/[[{]/)}},{key:"__routeRegExp",value:function(t){var e=t.split("[");if(e.length>2)throw new Error("Invalid use of optional params");var r=[],n=e[0].replace(/{([^}]+)}/g,function(t,e){return r.push(e),"([^/]+)"}).replace(/\//g,"\\/"),i="";return e[1]&&(i="(?:"+e[1].slice(0,-1).replace(/{([^}]+)}/g,function(t,e){return r.push(e),"([^/]+)"}).replace(/\//g,"\\/")+")?"),[new RegExp("^"+n+i+"$"),r]}},{key:"route",value:function(t,e){var r={route:t,type:"s",pattern:null,args:[],callback:e};if(!this.__isStatic(t)){r.type="v";var n=this.__routeRegExp(t);r.pattern=n[0],r.args=n[1]}this.handlers.push(r),this.__starting&&(this.__starting=!1,this.async(this.__tryStart))}},{key:"start",value:function(){var t=this;this.__starting=!0,this.check().then(function(e){e.length>0&&(t.__starting=!1,t.__tryStart())})}},{key:"__tryStart",value:function(){"history"===this.mode?(window.addEventListener("popstate",this.checkAndExecute.bind(this),!1),document.addEventListener("click",function(t){t.defaultPrevented||"A"!==t.target.nodeName||""!==t.target.target||(t.preventDefault(),this.history.pushState({url:t.target.getAttribute("href")},t.target.innerHTML,t.target.href),this.checkAndExecute())}.bind(this))):window.addEventListener("hashchange",this.checkAndExecute.bind(this),!1),this.checkAndExecute().then(function(){console.info("Started    "+this.__getId()),this.fire("started"),this.__started=!0}.bind(this))}},{key:"isStarted",value:function(){return this.__started||!1}},{key:"check",value:function(t){return new Promise(function(e,r){try{t=t||this.getFragment();var n=[];this.handlers.forEach(function(e){if("s"===e.type){if(t===e.route)return void n.push({handler:e,args:{}})}else if("v"===e.type){var r=t.match(e.pattern);if(r){var i={};e.args.forEach(function(t,e){i[t]=r[e+1]}),n.push({handler:e,args:i})}}}),e(n)}catch(i){r(i)}}.bind(this))}},{key:"checkAndExecute",value:function(){var t=this.getFragment();return this.check(t).then(function(e){if(e.length){var r=Promise.resolve();return this.middlewares.forEach(function(t){r=r.then(function(){return t.apply(this)}.bind(this))}.bind(this)),r.then(function(){return e.forEach(function(t){t.handler.callback(t.args)}),this.fire("navigated",{uri:t}),e}.bind(this))}return this.fire("route-not-found",t),[]}.bind(this))["catch"](function(t){console.error("Uncaught checkAndExecute error, "+t.stack)})}},{key:"navigate",value:function(t,e){if(t=t||"/",e=e||{},"history"===this.mode){var r=this.rootUri+t.toString().replace(/\/$/,"").replace(/^\//,"");this.location.href.replace(this.location.origin,"")!==r&&(this.history[e.replace?"replaceState":"pushState"]({},document.title,r),this.checkAndExecute())}else this.location.href.match(this.reHashSeparator),this.location.href=this.location.href.replace(this.reHashSeparator,"")+this.hashSeparator+t;return this}},{key:"use",value:function(t){this.middlewares.push(t)}},{key:"getFragment",value:function(){var t;if("history"===this.mode)t=decodeURI(this.location.pathname+this.location.search),t=t.replace(/\?(.*)$/,""),t="/"===this.rootUri?t:t.replace(this.rootUri,"");else{var e=this.location.href.match(this.reHashSeparator);t=e?e[1]:""}return"/"+t.toString().replace(/\/$/,"").replace(/^\//,"")}},{key:"$back",value:function(t){t.preventDefault(),this.history.back()}},{key:"props",get:function(){return{title:{type:String,value:"Application",observer:"_titleChanged"},mode:{type:String,value:"hash"},rootUri:{type:String,value:"/"},hashSeparator:{type:String,value:"#!",observer:"_hashSeparatorChanged"}}}}]),e}(s.Component);s.define("xin-app",h),s.App=h,t.exports=h}]);
//# sourceMappingURL=app.min.js.map