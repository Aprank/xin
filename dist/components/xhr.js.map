{"version":3,"sources":["webpack:///./components/xhr.js"],"names":["xin","require","XHR","debounce","__request","debounceDuration","url","generateUrl","request","method","as","then","xhr","fire","body","bind","err","error","options","toUpperCase","__prepareOptions","Promise","resolve","reject","XMLHttpRequest","open","async","onload","handleAs","contentType","getResponseHeader","indexOf","status","JSON","parse","responseText","responseXML","response","Error","onerror","send","type","String","value","observer","Number","Component","define","module","exports"],"mappings":"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","file":"components/xhr.js","sourcesContent":["/* globals XMLHttpRequest */\n\nconst xin = require('../');\n\nclass XHR extends xin.Component {\n  get props () {\n    return {\n      method: {\n        type: String,\n        value: 'get',\n      },\n\n      url: {\n        type: String,\n        observer: '__urlChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'intelligent',\n        observer: '__asChanged',\n      },\n\n      debounceDuration: {\n        type: Number,\n        value: 0,\n      },\n    };\n  }\n\n  __urlChanged () {\n    this.debounce('__request', this.__request, this.debounceDuration);\n  }\n\n  __asChanged () {\n    this.debounce('__request', this.__request, this.debounceDuration);\n  }\n\n  __request () {\n    var url = this.generateUrl();\n    if (!url) {\n      return;\n    }\n\n    return this.request({\n      method: this.method,\n      url: url,\n      as: this.as,\n    }).then(function (xhr) {\n      this.fire('response', {\n        body: xhr.body,\n        xhr: xhr,\n      });\n    }.bind(this), function (err) {\n      this.fire('error', {\n        error: err,\n        xhr: err.xhr,\n      });\n    }.bind(this));\n  }\n\n  generateUrl () {\n    return this.url;\n  }\n\n  __prepareOptions (options) {\n    options = options || {};\n    options.method = (options.method || 'get').toUpperCase();\n    return options;\n  }\n\n  request (options) {\n    options = this.__prepareOptions(options);\n    return new Promise(function (resolve, reject) {\n      var xhr = new XMLHttpRequest();\n      try {\n        xhr.open(options.method, options.url, options.async || true);\n        xhr.onload = function () {\n          var handleAs = options.as;\n          if (handleAs === 'intelligent') {\n            var contentType = xhr.getResponseHeader('Content-Type');\n            if (contentType.indexOf('json') >= 0) {\n              handleAs = 'json';\n            } else if (contentType.indexOf('html') >= 0) {\n              handleAs = 'html';\n            } else if (contentType.indexOf('xml') >= 0) {\n              handleAs = 'xml';\n            } else {\n              handleAs = 'text';\n            }\n          }\n          if (xhr.status >= 200 && xhr.status < 400) {\n            switch (handleAs) {\n              case 'json':\n                try {\n                  xhr.body = JSON.parse(xhr.responseText);\n                  resolve(xhr);\n                } catch (err) {\n                  err.xhr = xhr;\n                  reject(err);\n                }\n                break;\n              case 'xml':\n                xhr.body = xhr.responseXML;\n                resolve(xhr);\n                break;\n              default:\n                xhr.body = xhr.response;\n                resolve(xhr);\n            }\n          } else {\n            var err = new Error('Http status ' + xhr.status);\n            err.xhr = xhr;\n            reject(err);\n          }\n        };\n        xhr.onerror = function (err) {\n          err.xhr = xhr;\n          reject(err);\n        };\n        xhr.send(options.body);\n      } catch (err) {\n        err.xhr = xhr;\n        reject(err);\n      }\n    });\n  }\n}\n\nxin.define('xin-xhr', XHR);\nxin.XHR = XHR;\n\nmodule.exports = XHR;\n\n\n\n/** WEBPACK FOOTER **\n ** ./components/xhr.js\n **/"],"sourceRoot":""}