{"version":3,"sources":["webpack:///./components/xhr.js"],"names":["xin","require","XHR","debounce","__request","debounceDuration","url","generateUrl","request","method","as","then","xhr","fire","body","bind","err","error","options","toUpperCase","__prepareOptions","Promise","resolve","reject","XMLHttpRequest","doResolve","set","responseBody","doReject","open","async","onload","handleAs","contentType","getResponseHeader","indexOf","status","JSON","parse","responseText","responseXML","response","Error","onerror","send","type","String","value","observer","Number","Object","notify","Component","define","module","exports"],"mappings":"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","file":"components/xhr.js","sourcesContent":["/* globals XMLHttpRequest */\n\nconst xin = require('../');\n\nclass XHR extends xin.Component {\n  get props () {\n    return {\n      method: {\n        type: String,\n        value: 'get',\n      },\n\n      url: {\n        type: String,\n        observer: '_urlChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'intelligent',\n        observer: '_asChanged',\n      },\n\n      debounceDuration: {\n        type: Number,\n        value: 0,\n      },\n\n      request: {\n        type: Object,\n        notify: true,\n      },\n\n      response: {\n        type: Object,\n        notify: true,\n      },\n\n      error: {\n        type: Object,\n        notify: true,\n      },\n    };\n  }\n\n  _urlChanged () {\n    this.debounce('__request', this.__request, this.debounceDuration);\n  }\n\n  _asChanged () {\n    this.debounce('__request', this.__request, this.debounceDuration);\n  }\n\n  __request () {\n    var url = this.generateUrl();\n    if (!url) {\n      return;\n    }\n\n    return this.request({\n      method: this.method,\n      url: url,\n      as: this.as,\n    }).then(function (xhr) {\n      this.fire('response', {\n        body: xhr.body,\n        xhr: xhr,\n      });\n    }.bind(this), function (err) {\n      this.fire('error', {\n        error: err,\n        xhr: err.xhr,\n      });\n    }.bind(this));\n  }\n\n  generateUrl () {\n    return this.url;\n  }\n\n  __prepareOptions (options) {\n    options = options || {};\n    options.method = (options.method || 'get').toUpperCase();\n    return options;\n  }\n\n  request (options) {\n    options = this.__prepareOptions(options);\n\n    return new Promise((resolve, reject) => {\n      let xhr = new XMLHttpRequest();\n      let doResolve = () => {\n        this.set('response', xhr.responseBody);\n        resolve(xhr);\n      };\n      let doReject = err => {\n        this.set('error', err);\n        reject(err);\n      };\n\n      try {\n        xhr.open(options.method, options.url, options.async || true);\n        xhr.onload = () => {\n          var handleAs = options.as;\n          if (handleAs === 'intelligent') {\n            var contentType = xhr.getResponseHeader('Content-Type');\n            if (contentType.indexOf('json') >= 0) {\n              handleAs = 'json';\n            } else if (contentType.indexOf('html') >= 0) {\n              handleAs = 'html';\n            } else if (contentType.indexOf('xml') >= 0) {\n              handleAs = 'xml';\n            } else {\n              handleAs = 'text';\n            }\n          }\n          if (xhr.status >= 200 && xhr.status < 400) {\n            switch (handleAs) {\n              case 'json':\n                try {\n                  xhr.responseBody = JSON.parse(xhr.responseText);\n                } catch (err) {\n                  return doReject(err);\n                }\n                break;\n              case 'xml':\n                xhr.responseBody = xhr.responseXML;\n                break;\n              default:\n                xhr.responseBody = xhr.response;\n                break;\n            }\n            doResolve();\n          } else {\n            doReject(new Error('Http status ' + xhr.status));\n          }\n        };\n        xhr.onerror = doReject;\n        xhr.send(options.body);\n      } catch (err) {\n        doReject(err);\n      }\n    });\n  }\n}\n\nxin.define('xin-xhr', XHR);\nxin.XHR = XHR;\n\nmodule.exports = XHR;\n\n\n\n/** WEBPACK FOOTER **\n ** ./components/xhr.js\n **/"],"sourceRoot":""}