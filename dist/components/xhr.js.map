{"version":3,"sources":["webpack:///./components/xhr.js"],"names":["XHR","auto","generateRequest","url","generateUrl","req","method","as","then","body","xhr","fire","error","err","debounce","_requestFlight","debounceDuration","options","toUpperCase","__prepareOptions","Promise","resolve","reject","window","XMLHttpRequest","doResolve","set","responseBody","doReject","open","async","onload","handleAs","contentType","getResponseHeader","indexOf","status","JSON","parse","responseText","responseXML","response","Error","onerror","send","type","Boolean","value","String","observer","Number","request","Object","notify","Component","define"],"mappings":"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","file":"components/xhr.js","sourcesContent":["import xin from '../src/';\n\nclass XHR extends xin.Component {\n  get props () {\n    return {\n      auto: {\n        type: Boolean,\n        value: false,\n      },\n\n      method: {\n        type: String,\n        value: 'get',\n      },\n\n      url: {\n        type: String,\n        observer: '_urlChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'intelligent',\n        observer: '_asChanged',\n      },\n\n      debounceDuration: {\n        type: Number,\n        value: 0,\n      },\n\n      request: {\n        type: Object,\n        notify: true,\n      },\n\n      response: {\n        type: Object,\n        notify: true,\n      },\n\n      error: {\n        type: Object,\n        notify: true,\n      },\n    };\n  }\n\n  _urlChanged () {\n    if (this.auto) {\n      this.generateRequest();\n    }\n  }\n\n  _asChanged () {\n    if (this.auto) {\n      this.generateRequest();\n    }\n  }\n\n  _requestFlight () {\n    let url = this.generateUrl();\n    if (!url) {\n      return;\n    }\n\n    return this.req({\n      method: this.method,\n      url: url,\n      as: this.as,\n    }).then(xhr => {\n      let body = xhr.body;\n      this.fire('response', {\n        body: body,\n        xhr: xhr,\n      });\n      return body;\n    }, err => {\n      this.fire('error', {\n        error: err,\n        xhr: err.xhr,\n      });\n      throw err;\n    });\n  }\n\n  generateRequest () {\n    this.debounce('_requestFlight', this._requestFlight, this.debounceDuration);\n  }\n\n  generateUrl () {\n    return this.url;\n  }\n\n  __prepareOptions (options) {\n    options = options || {};\n    options.method = (options.method || 'get').toUpperCase();\n    return options;\n  }\n\n  req (options) {\n    options = this.__prepareOptions(options);\n\n    return new Promise((resolve, reject) => {\n      let xhr = new window.XMLHttpRequest();\n      let doResolve = () => {\n        this.set('response', xhr.responseBody);\n        resolve(xhr);\n      };\n      let doReject = err => {\n        this.set('error', err);\n        reject(err);\n      };\n\n      try {\n        xhr.open(options.method, options.url, options.async || true);\n        xhr.onload = () => {\n          var handleAs = options.as;\n          if (handleAs === 'intelligent') {\n            var contentType = xhr.getResponseHeader('Content-Type');\n            if (contentType.indexOf('json') >= 0) {\n              handleAs = 'json';\n            } else if (contentType.indexOf('html') >= 0) {\n              handleAs = 'html';\n            } else if (contentType.indexOf('xml') >= 0) {\n              handleAs = 'xml';\n            } else {\n              handleAs = 'text';\n            }\n          }\n          if (xhr.status >= 200 && xhr.status < 400) {\n            switch (handleAs) {\n              case 'json':\n                try {\n                  xhr.responseBody = JSON.parse(xhr.responseText);\n                } catch (err) {\n                  return doReject(err);\n                }\n                break;\n              case 'xml':\n                xhr.responseBody = xhr.responseXML;\n                break;\n              default:\n                xhr.responseBody = xhr.response;\n                break;\n            }\n            doResolve();\n          } else {\n            doReject(new Error('Http status ' + xhr.status));\n          }\n        };\n        xhr.onerror = doReject;\n        xhr.send(options.body);\n      } catch (err) {\n        doReject(err);\n      }\n    });\n  }\n}\n\nxin.define('xin-xhr', XHR);\nxin.XHR = XHR;\n\nexport default XHR;\n\n\n\n// WEBPACK FOOTER //\n// ./components/xhr.js"],"sourceRoot":""}