{"version":3,"sources":["webpack:///./components/xhr.js"],"names":["XHR","auto","generateRequest","url","generateUrl","req","method","as","then","fire","xhr","responseBody","error","err","debounce","_requestFlight","debounceDuration","options","toUpperCase","__prepareOptions","Promise","resolve","reject","window","XMLHttpRequest","doResolve","set","doReject","open","async","onload","handleAs","contentType","getResponseHeader","indexOf","status","JSON","parse","responseText","responseXML","response","Error","onerror","send","body","type","Boolean","value","String","observer","Number","request","Object","notify","Component","define"],"mappings":"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","file":"components/xhr.js","sourcesContent":["import xin from '../src/';\n\nclass XHR extends xin.Component {\n  get props () {\n    return {\n      auto: {\n        type: Boolean,\n        value: false,\n      },\n\n      method: {\n        type: String,\n        value: 'get',\n      },\n\n      url: {\n        type: String,\n        observer: '_urlChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'intelligent',\n        observer: '_asChanged',\n      },\n\n      debounceDuration: {\n        type: Number,\n        value: 0,\n      },\n\n      request: {\n        type: Object,\n        notify: true,\n      },\n\n      response: {\n        type: Object,\n        notify: true,\n      },\n\n      error: {\n        type: Object,\n        notify: true,\n      },\n    };\n  }\n\n  _urlChanged () {\n    if (this.auto) {\n      this.generateRequest();\n    }\n  }\n\n  _asChanged () {\n    if (this.auto) {\n      this.generateRequest();\n    }\n  }\n\n  _requestFlight () {\n    let url = this.generateUrl();\n    if (!url) {\n      return;\n    }\n\n    return this.req({\n      method: this.method,\n      url: url,\n      as: this.as,\n    }).then(xhr => {\n      // let body = xhr.body;\n      this.fire('response', {\n        // body: body,\n        xhr: xhr,\n      });\n      return xhr.responseBody;\n    }, err => {\n      this.fire('error', {\n        error: err,\n        xhr: err.xhr,\n      });\n      throw err;\n    });\n  }\n\n  generateRequest () {\n    this.debounce('_requestFlight', this._requestFlight, this.debounceDuration);\n  }\n\n  generateUrl () {\n    return this.url;\n  }\n\n  __prepareOptions (options) {\n    options = options || {};\n    options.method = (options.method || 'get').toUpperCase();\n    return options;\n  }\n\n  req (options) {\n    options = this.__prepareOptions(options);\n\n    return new Promise((resolve, reject) => {\n      let xhr = new window.XMLHttpRequest();\n      let doResolve = () => {\n        this.set('response', xhr.responseBody);\n        resolve(xhr);\n      };\n      let doReject = err => {\n        this.set('error', err);\n        reject(err);\n      };\n\n      try {\n        xhr.open(options.method, options.url, options.async || true);\n        xhr.onload = () => {\n          var handleAs = options.as;\n          if (handleAs === 'intelligent') {\n            var contentType = xhr.getResponseHeader('Content-Type');\n            if (contentType.indexOf('json') >= 0) {\n              handleAs = 'json';\n            } else if (contentType.indexOf('html') >= 0) {\n              handleAs = 'html';\n            } else if (contentType.indexOf('xml') >= 0) {\n              handleAs = 'xml';\n            } else {\n              handleAs = 'text';\n            }\n          }\n          if (xhr.status >= 200 && xhr.status < 400) {\n            switch (handleAs) {\n              case 'json':\n                try {\n                  xhr.responseBody = JSON.parse(xhr.responseText);\n                } catch (err) {\n                  return doReject(err);\n                }\n                break;\n              case 'xml':\n                xhr.responseBody = xhr.responseXML;\n                break;\n              default:\n                xhr.responseBody = xhr.response;\n                break;\n            }\n            doResolve();\n          } else {\n            doReject(new Error('Http status ' + xhr.status));\n          }\n        };\n        xhr.onerror = doReject;\n        xhr.send(options.body);\n      } catch (err) {\n        doReject(err);\n      }\n    });\n  }\n}\n\nxin.define('xin-xhr', XHR);\n// xin.XHR = XHR;\n\nexport default XHR;\n\n\n\n// WEBPACK FOOTER //\n// ./components/xhr.js"],"sourceRoot":""}