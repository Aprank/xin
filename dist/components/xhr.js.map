{"version":3,"sources":["webpack:///./components/xhr.js"],"names":["XHR","xin","Component","props","auto","type","Boolean","value","method","String","url","observer","as","debounceDuration","Number","request","Object","notify","response","error","_urlChanged","generateRequest","_asChanged","_requestFlight","generateUrl","req","then","xhr","fire","responseBody","err","debounce","__prepareOptions","options","toUpperCase","Promise","resolve","reject","window","XMLHttpRequest","doResolve","set","doReject","open","async","onload","handleAs","contentType","getResponseHeader","indexOf","status","JSON","parse","responseText","responseXML","Error","onerror","send","body","define"],"mappings":"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","file":"components/xhr.js","sourcesContent":["import xin from '../';\n\nclass XHR extends xin.Component {\n  get props () {\n    return {\n      auto: {\n        type: Boolean,\n        value: false,\n      },\n\n      method: {\n        type: String,\n        value: 'get',\n      },\n\n      url: {\n        type: String,\n        observer: '_urlChanged',\n      },\n\n      as: {\n        type: String,\n        value: 'intelligent',\n        observer: '_asChanged',\n      },\n\n      debounceDuration: {\n        type: Number,\n        value: 0,\n      },\n\n      request: {\n        type: Object,\n        notify: true,\n      },\n\n      response: {\n        type: Object,\n        notify: true,\n      },\n\n      error: {\n        type: Object,\n        notify: true,\n      },\n    };\n  }\n\n  _urlChanged () {\n    if (this.auto) {\n      this.generateRequest();\n    }\n  }\n\n  _asChanged () {\n    if (this.auto) {\n      this.generateRequest();\n    }\n  }\n\n  _requestFlight () {\n    let url = this.generateUrl();\n    if (!url) {\n      return;\n    }\n\n    return this.req({\n      method: this.method,\n      url: url,\n      as: this.as,\n    }).then(xhr => {\n      // let body = xhr.body;\n      this.fire('response', {\n        // body: body,\n        xhr: xhr,\n      });\n      return xhr.responseBody;\n    }, err => {\n      this.fire('error', {\n        error: err,\n        xhr: err.xhr,\n      });\n      throw err;\n    });\n  }\n\n  generateRequest () {\n    this.debounce('_requestFlight', this._requestFlight, this.debounceDuration);\n  }\n\n  generateUrl () {\n    return this.url;\n  }\n\n  __prepareOptions (options) {\n    options = options || {};\n    options.method = (options.method || 'get').toUpperCase();\n    return options;\n  }\n\n  req (options) {\n    options = this.__prepareOptions(options);\n\n    return new Promise((resolve, reject) => {\n      let xhr = new window.XMLHttpRequest();\n      let doResolve = () => {\n        this.set('response', xhr.responseBody);\n        resolve(xhr);\n      };\n      let doReject = err => {\n        this.set('error', err);\n        reject(err);\n      };\n\n      try {\n        xhr.open(options.method, options.url, options.async || true);\n        xhr.onload = () => {\n          var handleAs = options.as;\n          if (handleAs === 'intelligent') {\n            var contentType = xhr.getResponseHeader('Content-Type');\n            if (contentType.indexOf('json') >= 0) {\n              handleAs = 'json';\n            } else if (contentType.indexOf('html') >= 0) {\n              handleAs = 'html';\n            } else if (contentType.indexOf('xml') >= 0) {\n              handleAs = 'xml';\n            } else {\n              handleAs = 'text';\n            }\n          }\n          if (xhr.status >= 200 && xhr.status < 400) {\n            switch (handleAs) {\n              case 'json':\n                try {\n                  xhr.responseBody = JSON.parse(xhr.responseText);\n                } catch (err) {\n                  return doReject(err);\n                }\n                break;\n              case 'xml':\n                xhr.responseBody = xhr.responseXML;\n                break;\n              default:\n                xhr.responseBody = xhr.response;\n                break;\n            }\n            doResolve();\n          } else {\n            doReject(new Error('Http status ' + xhr.status));\n          }\n        };\n        xhr.onerror = doReject;\n        xhr.send(options.body);\n      } catch (err) {\n        doReject(err);\n      }\n    });\n  }\n}\n\nxin.define('xin-xhr', XHR);\n// xin.XHR = XHR;\n\nexport default XHR;\n\n\n\n// WEBPACK FOOTER //\n// ./components/xhr.js"],"sourceRoot":""}