{"version":3,"sources":["webpack:///./components/app.js"],"names":["NOOP","App","evt","console","error","detail","title","document","put","__appSignature","location","window","history","handlers","middlewares","__awaitRouteCallback","__started","__starting","manual","async","__availableUris","map","call","querySelectorAll","el","uri","start","pattern","match","str","chunks","split","length","Error","tokens","re","replace","g","token","push","optRe","slice","RegExp","route","callback","routeHandler","type","args","__isStatic","result","__routeRegExp","getFragmentExecutors","getFragment","__middlewareChainRun","compose","info","is","__id","__execute","executed","__listenNavigation","fire","mode","event","on","defaultPrevented","target","nodeName","preventDefault","state","url","getAttribute","pushState","innerHTML","href","fragment","reduce","executors","handler","forEach","name","index","Promise","resolve","reject","indexOf","__waitForRoute","context","executor","path","options","rootUri","toString","origin","hashSeparator","middleware","decodeURI","pathname","search","err","docTitle","String","value","observer","Boolean","Component","define","fn","TypeError","next","i","dispatch"],"mappings":"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","file":"components/app.js","sourcesContent":["import xin from '../src';\n\nconst NOOP = () => {};\n\nclass App extends xin.Component {\n  get props () {\n    return {\n      docTitle: {\n        type: String,\n        value: 'Application',\n        observer: '_titleChanged',\n      },\n\n      manual: {\n        type: Boolean,\n      },\n\n      mode: {\n        type: String,\n        value: 'hash',\n      },\n\n      rootUri: {\n        type: String,\n        value: '/',\n      },\n\n      hashSeparator: {\n        type: RegExp,\n        value: () => /#!(.*)$/,\n      },\n    };\n  }\n\n  get listeners () {\n    return {\n      'route-not-found': 'handleRouteNotFound(evt)',\n    };\n  }\n\n  handleRouteNotFound (evt) {\n    console.error('Route not found: ' + evt.detail);\n  }\n\n  _titleChanged (title) {\n    document.title = title;\n  }\n\n  created () {\n    xin.put('app', this);\n\n    // this.classList.add('xin-app');\n\n    this.__appSignature = true;\n    this.location = window.location;\n    this.history = window.history;\n\n    // default values\n    this.handlers = [];\n    this.middlewares = [];\n\n    this.__awaitRouteCallback = NOOP;\n    this.__started = false;\n    this.__starting = false;\n  }\n\n  attached () {\n    if (!this.manual) {\n      this.async(() => {\n        this.__availableUris = [].map.call(this.querySelectorAll('.xin-view'), el => el.uri);\n        this.start();\n      });\n    }\n  }\n\n  __isStatic (pattern) {\n    return !pattern.match(/[[{]/);\n  }\n\n  __routeRegExp (str) {\n    let chunks = str.split('[');\n\n    if (chunks.length > 2) {\n      throw new Error('Invalid use of optional params');\n    }\n\n    let tokens = [];\n    let re = chunks[0].replace(/{([^}]+)}/g, function (g, token) {\n      tokens.push(token);\n      return '([^/]+)';\n    }).replace(/\\//g, '\\\\/');\n\n    let optRe = '';\n\n    if (chunks[1]) {\n      optRe = '(?:' + chunks[1].slice(0, -1).replace(/{([^}]+)}/g, function (g, token) {\n        tokens.push(token);\n        return '([^/]+)';\n      }).replace(/\\//g, '\\\\/') + ')?';\n    }\n    return [ new RegExp('^' + re + optRe + '$'), tokens ];\n  }\n\n  route (route, callback) {\n    let routeHandler = {\n      route: route,\n      type: 's',\n      pattern: null,\n      args: [],\n      callback: callback,\n    };\n\n    if (!this.__isStatic(route)) {\n      let result = this.__routeRegExp(route);\n\n      routeHandler.type = 'v';\n      routeHandler.pattern = result[0];\n      routeHandler.args = result[1];\n    }\n\n    this.handlers.push(routeHandler);\n\n    this.__awaitRouteCallback(this.getFragmentExecutors(this.getFragment()));\n  }\n\n  async start () {\n    if (this.__started || this.__starting) {\n      return;\n    }\n\n    this.__middlewareChainRun = compose(this.middlewares);\n\n    console.info(`Starting ${this.is}:${this.__id} ...`);\n\n    this.__starting = true;\n    let executed = await this.__execute();\n    this.__starting = false;\n\n    if (executed) {\n      console.info(`Started ${this.is}:${this.__id}`);\n\n      this.__started = true;\n\n      this.__listenNavigation();\n\n      this.fire('started');\n    }\n  }\n\n  __listenNavigation () {\n    let callback = () => {\n      this.__execute();\n    };\n\n    if (this.mode === 'history') {\n      xin.event(window).on('popstate', callback);\n      xin.event(document).on('click', evt => {\n        if (!evt.defaultPrevented && evt.target.nodeName === 'A' && evt.target.target === '') {\n          evt.preventDefault();\n\n          let state = { url: evt.target.getAttribute('href') };\n          this.history.pushState(state, evt.target.innerHTML, evt.target.href);\n\n          callback();\n        }\n      });\n    } else {\n      xin.event(window).on('hashchange', callback);\n    }\n  }\n\n  get started () {\n    return this.__started || false;\n  }\n\n  getFragmentExecutors (fragment) {\n    return this.handlers.reduce((executors, handler) => {\n      if (handler.type === 's') {\n        if (fragment === handler.route) {\n          executors.push({ handler: handler, args: {} });\n        }\n      } else if (handler.type === 'v') {\n        let result = fragment.match(handler.pattern);\n        if (result) {\n          let args = {};\n\n          handler.args.forEach(function (name, index) {\n            args[name] = result[index + 1];\n          });\n\n          executors.push({\n            handler: handler,\n            args: args,\n          });\n        }\n      }\n      return executors;\n    }, []);\n  }\n\n  __waitForRoute () {\n    return new Promise((resolve, reject) => {\n      this.__awaitRouteCallback = (executors) => {\n        if (executors.length === 0) {\n          return;\n        }\n\n        this.__awaitRouteCallback = NOOP;\n        resolve(executors);\n      };\n    });\n  }\n\n  async __execute () {\n    let fragment = this.getFragment();\n    let executors = this.getFragmentExecutors(fragment);\n    if (executors.length === 0) {\n      if (this.__availableUris.indexOf(fragment) === -1) {\n        this.fire('route-not-found', fragment);\n        return false;\n      }\n\n      executors = await this.__waitForRoute();\n    }\n\n    let context = { uri: fragment };\n\n    this.fire('navigated', context);\n\n    // run middleware chain then execute all executors\n    await this.__middlewareChainRun(context, () => {\n      executors.forEach(executor => {\n        executor.handler.callback(executor.args, context);\n      });\n    });\n\n    return true;\n  }\n\n  navigate (path, options) {\n    path = path || '/';\n    options = options || {};\n\n    if (this.mode === 'history') {\n      let url = this.rootUri + path.toString().replace(/\\/$/, '').replace(/^\\//, '');\n      if (this.location.href.replace(this.location.origin, '') !== url) {\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        this.__execute();\n      }\n    } else {\n      this.location.href.match(this.hashSeparator);\n      this.location.href = this.location.href.replace(this.hashSeparator, '') + this.hashSeparator + path;\n    }\n    return this;\n  }\n\n  use (middleware) {\n    this.middlewares.push(middleware);\n  }\n\n  getFragment () {\n    try {\n      let fragment;\n      if (this.mode === 'history') {\n        fragment = decodeURI(this.location.pathname + this.location.search);\n        fragment = fragment.replace(/\\?(.*)$/, '');\n        fragment = this.rootUri === '/' ? fragment : fragment.replace(this.rootUri, '');\n      } else {\n        let match = this.location.href.match(this.hashSeparator);\n        fragment = match ? match[1] : '';\n      }\n\n      return '/' + fragment.toString().replace(/\\/$/, '').replace(/^\\//, '');\n    } catch (err) {\n      console.error('Fragment is not match any pattern, fallback to /');\n      return '/';\n    }\n  }\n\n  // $back (evt) {\n  //   evt.preventDefault();\n  //   this.history.back();\n  // }\n}\n\nxin.define('xin-app', App);\n\nfunction compose (middlewares) {\n  for (const fn of middlewares) {\n    if (typeof fn !== 'function') {\n      throw new TypeError('Middleware must be composed of functions!');\n    }\n  }\n\n  return async (context, next) => {\n    // last called middlewares #\n    let index = -1;\n\n    async function dispatch (i) {\n      if (i <= index) {\n        throw new Error('next() called multiple times');\n      }\n\n      index = i;\n      let fn = middlewares[i];\n      if (i === middlewares.length) {\n        fn = next;\n      }\n      if (!fn) {\n        return;\n      }\n\n      return await fn(context, () => dispatch(i + 1));\n    }\n\n    return dispatch(0);\n  };\n}\n\nxin.App = App;\n\nexport default App;\n\n\n\n// WEBPACK FOOTER //\n// ./components/app.js"],"sourceRoot":""}