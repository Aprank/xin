{"version":3,"sources":["webpack:///./components/lib/route.js","webpack:///./components/app.js"],"names":["Route","str","chunks","split","length","Error","tokens","re","replace","g","token","push","optRe","slice","RegExp","pattern","match","route","callback","isStatic","type","args","result","routeRegExp","fragment","handler","reduce","name","index","App","console","warn","title","document","put","__appSignature","location","window","history","handlers","middlewares","__started","__starting","manual","async","start","__middlewareChainRun","compose","__listenNavigation","info","is","__id","__execute","executed","fire","mode","event","on","evt","defaultPrevented","target","nodeName","preventDefault","state","url","getAttribute","pushState","innerHTML","href","executors","executor","getExecutorFor","getFragment","context","app","uri","getFragmentExecutors","notFound","forEach","willContinue","path","options","rootUri","toString","origin","hashSeparator","middleware","decodeURI","pathname","search","err","error","docTitle","String","value","observer","Boolean","Component","define","fn","TypeError","next","i","dispatch"],"mappings":"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","file":"components/app.js","sourcesContent":["class Route {\n  static routeRegExp (str) {\n    let chunks = str.split('[');\n\n    if (chunks.length > 2) {\n      throw new Error('Invalid use of optional params');\n    }\n\n    let tokens = [];\n    let re = chunks[0].replace(/{([^}]+)}/g, function (g, token) {\n      tokens.push(token);\n      return '([^/]+)';\n    }).replace(/\\//g, '\\\\/');\n\n    let optRe = '';\n\n    if (chunks[1]) {\n      optRe = '(?:' + chunks[1].slice(0, -1).replace(/{([^}]+)}/g, function (g, token) {\n        tokens.push(token);\n        return '([^/]+)';\n      }).replace(/\\//g, '\\\\/') + ')?';\n    }\n    return [ new RegExp('^' + re + optRe + '$'), tokens ];\n  }\n\n  static isStatic (pattern) {\n    return !pattern.match(/[[{]/);\n  }\n\n  constructor (route, callback) {\n    this.route = route;\n    this.callback = callback;\n\n    if (Route.isStatic(route)) {\n      this.type = 's';\n      this.pattern = null;\n      this.args = [];\n    } else {\n      let result = Route.routeRegExp(route);\n      this.type = 'v';\n      this.pattern = result[0];\n      this.args = result[1];\n    }\n  }\n\n  getExecutorFor (fragment) {\n    if (this.type === 's') {\n      if (fragment === this.route) {\n        return { handler: this, args: {} };\n      }\n    } else if (this.type === 'v') {\n      let result = fragment.match(this.pattern);\n      if (result) {\n        return {\n          handler: this,\n          args: this.args.reduce((args, name, index) => {\n            args[name] = result[index + 1];\n            return args;\n          }, {}),\n        };\n      }\n    }\n  }\n}\n\nexport default Route;\n\n\n\n// WEBPACK FOOTER //\n// ./components/lib/route.js","import xin from '../src';\nimport Route from './lib/route';\n\n// const NOOP = () => {};\n\nclass App extends xin.Component {\n  get props () {\n    return {\n      docTitle: {\n        type: String,\n        value: 'Application',\n        observer: '_titleChanged',\n      },\n\n      manual: {\n        type: Boolean,\n      },\n\n      mode: {\n        type: String,\n        value: 'hash',\n      },\n\n      rootUri: {\n        type: String,\n        value: '/',\n      },\n\n      hashSeparator: {\n        type: RegExp,\n        value: () => /#!(.*)$/,\n      },\n    };\n  }\n\n  notFound (fragment) {\n    console.warn(`Route not found: ${fragment}`);\n  }\n\n  _titleChanged (title) {\n    document.title = title;\n  }\n\n  created () {\n    xin.put('app', this);\n\n    // this.classList.add('xin-app');\n\n    this.__appSignature = true;\n    this.location = window.location;\n    this.history = window.history;\n\n    // default values\n    this.handlers = [];\n    this.middlewares = [];\n\n    // this.__awaitRouteCallback = NOOP;\n    this.__started = false;\n    this.__starting = false;\n  }\n\n  attached () {\n    if (!this.manual) {\n      this.async(() => {\n        // this.__availableUris = [].map.call(this.querySelectorAll('.xin-view'), el => el.uri);\n        this.start();\n      });\n    }\n  }\n\n  route (route, callback) {\n    this.handlers.push(new Route(route, callback));\n    // this.__awaitRouteCallback(this.getFragmentExecutors(this.getFragment()));\n  }\n\n  async start () {\n    if (this.__started || this.__starting) {\n      return;\n    }\n\n    this.__middlewareChainRun = compose(this.middlewares);\n\n    this.__listenNavigation();\n\n    console.info(`Starting ${this.is}:${this.__id} ...`);\n\n    this.__starting = true;\n    let executed = await this.__execute();\n    this.__starting = false;\n\n    if (executed) {\n      console.info(`Started ${this.is}:${this.__id}`);\n\n      this.__started = true;\n\n      this.fire('started');\n    }\n  }\n\n  __listenNavigation () {\n    let callback = () => {\n      this.__execute();\n    };\n\n    if (this.mode === 'history') {\n      xin.event(window).on('popstate', callback);\n      xin.event(document).on('click', evt => {\n        if (!evt.defaultPrevented && evt.target.nodeName === 'A' && evt.target.target === '') {\n          evt.preventDefault();\n\n          let state = { url: evt.target.getAttribute('href') };\n          this.history.pushState(state, evt.target.innerHTML, evt.target.href);\n\n          callback();\n        }\n      });\n    } else {\n      xin.event(window).on('hashchange', callback);\n    }\n  }\n\n  get started () {\n    return this.__started || false;\n  }\n\n  getFragmentExecutors (fragment) {\n    return this.handlers.reduce((executors, handler) => {\n      let executor = handler.getExecutorFor(fragment);\n      if (executor) executors.push(executor);\n      return executors;\n    }, []);\n  }\n\n  // __waitForRoute () {\n  //   return new Promise((resolve, reject) => {\n  //     this.__awaitRouteCallback = (executors) => {\n  //       if (executors.length === 0) {\n  //         return;\n  //       }\n  //\n  //       this.__awaitRouteCallback = NOOP;\n  //       resolve(executors);\n  //     };\n  //   });\n  // }\n\n  async __execute () {\n    let fragment = this.getFragment();\n    let context = { app: this, uri: fragment };\n\n    // run middleware chain then execute all executors\n    let willContinue = await this.__middlewareChainRun(context, () => {\n      let executors = this.getFragmentExecutors(context.uri);\n      if (executors.length === 0) {\n        this.notFound(fragment);\n        this.fire('route-not-found', fragment);\n        return;\n        // if (this.__availableUris.indexOf(fragment) === -1) {\n        // }\n        // executors = await this.__waitForRoute();\n      }\n\n      executors.forEach(executor => {\n        executor.handler.callback(executor.args, context);\n      });\n    });\n\n    if (willContinue === false) {\n      return false;\n    }\n\n    this.fire('navigated', context);\n    return true;\n  }\n\n  navigate (path, options) {\n    path = path || '/';\n    options = options || {};\n\n    if (this.mode === 'history') {\n      let url = this.rootUri + path.toString().replace(/\\/$/, '').replace(/^\\//, '');\n      if (this.location.href.replace(this.location.origin, '') !== url) {\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        this.__execute();\n      }\n    } else {\n      this.location.href.match(this.hashSeparator);\n      this.location.href = this.location.href.replace(this.hashSeparator, '') + this.hashSeparator + path;\n    }\n    return this;\n  }\n\n  use (middleware) {\n    this.middlewares.push(middleware);\n  }\n\n  getFragment () {\n    try {\n      let fragment;\n      if (this.mode === 'history') {\n        fragment = decodeURI(this.location.pathname + this.location.search);\n        fragment = fragment.replace(/\\?(.*)$/, '');\n        fragment = this.rootUri === '/' ? fragment : fragment.replace(this.rootUri, '');\n      } else {\n        let match = this.location.href.match(this.hashSeparator);\n        fragment = match ? match[1] : '';\n      }\n\n      return '/' + fragment.toString().replace(/\\/$/, '').replace(/^\\//, '');\n    } catch (err) {\n      console.error('Fragment is not match any pattern, fallback to /');\n      return '/';\n    }\n  }\n\n  // $back (evt) {\n  //   evt.preventDefault();\n  //   this.history.back();\n  // }\n}\n\nxin.define('xin-app', App);\n\nfunction compose (middlewares) {\n  for (let fn of middlewares) {\n    if (typeof fn !== 'function') {\n      throw new TypeError('Middleware must be composed of functions!');\n    }\n  }\n\n  return async (context, next) => {\n    // last called middlewares #\n    let index = -1;\n\n    async function dispatch (i) {\n      if (i <= index) {\n        throw new Error('next() called multiple times');\n      }\n\n      index = i;\n      let fn = middlewares[i];\n      if (i === middlewares.length) {\n        fn = next;\n      }\n      if (!fn) {\n        return;\n      }\n\n      return await fn(context, () => dispatch(i + 1));\n    }\n\n    return dispatch(0);\n  };\n}\n\n// xin.App = App;\nexport default App;\n\n\n\n// WEBPACK FOOTER //\n// ./components/app.js"],"sourceRoot":""}